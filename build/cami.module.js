var gt=Object.defineProperty;var xt=Object.defineProperties;var vt=Object.getOwnPropertyDescriptors;var Le=Object.getOwnPropertySymbols;var Et=Object.prototype.hasOwnProperty;var $t=Object.prototype.propertyIsEnumerable;var We=(r,e)=>{return(e=Symbol[r])?e:Symbol.for("Symbol."+r)};var de=(r,e,t)=>e in r?gt(r,e,{enumerable:true,configurable:true,writable:true,value:t}):r[e]=t;var T=(r,e)=>{for(var t in e||(e={}))if(Et.call(e,t))de(r,t,e[t]);if(Le)for(var t of Le(e)){if($t.call(e,t))de(r,t,e[t])}return r};var _e=(r,e)=>xt(r,vt(e));var Qe=(r,e,t)=>{de(r,typeof e!=="symbol"?e+"":e,t);return t};var k=(r,e,t)=>{return new Promise((s,n)=>{var i=a=>{try{c(t.next(a))}catch(u){n(u)}};var o=a=>{try{c(t.throw(a))}catch(u){n(u)}};var c=a=>a.done?s(a.value):Promise.resolve(a.value).then(i,o);c((t=t.apply(r,e)).next())})};var pe=(r,e,t)=>(e=r[We("asyncIterator")])?e.call(r):(r=r[We("iterator")](),e={},t=(s,n)=>(n=r[s])&&(e[s]=i=>new Promise((o,c,a)=>(i=n.call(r,i),a=i.done,Promise.resolve(i.value).then(u=>o({value:u,done:a}),c)))),t("next"),t("return"),e);var Ot=globalThis;var $=r=>r;var Z=Ot.trustedTypes;var qe=Z?Z.createPolicy("cami-html",{createHTML:r=>r}):void 0;var tt="$cami$";var P=`cami$${String(Math.random()).slice(9)}$`;var rt="?"+P;var St=`<${rt}>`;var M=document;var B=()=>M.createComment("");var G=r=>r===null||typeof r!="object"&&typeof r!="function";var st=Array.isArray;var At=r=>st(r)||typeof(r==null?void 0:r[Symbol.iterator])==="function";var me=`[ 	
\f\r]`;var Tt=`[^ 	
\f\r"'\`<>=]`;var Ct=`[^\\s"'>=/]`;var q=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g;var Be=1;var be=2;var Pt=3;var Ge=/-->/g;var Je=/>/g;var R=new RegExp(`>|${me}(?:(${Ct}+)(${me}*=${me}*(?:${Tt}|("|')|))|$)`,"g");var jt=0;var Xe=1;var Dt=2;var Ke=3;var Ye=/'/g;var Ze=/"/g;var nt=/^(?:script|style|textarea|title)$/i;var Rt=1;var ee=2;var Ee=1;var te=2;var Vt=3;var Mt=4;var It=5;var $e=6;var Nt=7;var it=r=>(e,...t)=>{return{["_$camiType$"]:r,strings:e,values:t}};var ot=it(Rt);var Ft=it(ee);var J=Symbol.for("cami-noChange");var p=Symbol.for("cami-nothing");var et=new WeakMap;var V=M.createTreeWalker(M,129);function ct(r,e){if(!Array.isArray(r)||!r.hasOwnProperty("raw")){let t="invalid template strings array";throw new Error(t)}return qe!==void 0?qe.createHTML(e):e}var zt=(r,e)=>{const t=r.length-1;const s=[];let n=e===ee?"<svg>":"";let i;let o=q;for(let a=0;a<t;a++){const u=r[a];let f=-1;let l;let d=0;let h;while(d<u.length){o.lastIndex=d;h=o.exec(u);if(h===null){break}d=o.lastIndex;if(o===q){if(h[Be]==="!--"){o=Ge}else if(h[Be]!==void 0){o=Je}else if(h[be]!==void 0){if(nt.test(h[be])){i=new RegExp(`</${h[be]}`,"g")}o=R}else if(h[Pt]!==void 0){o=R}}else if(o===R){if(h[jt]===">"){o=i!=null?i:q;f=-1}else if(h[Xe]===void 0){f=-2}else{f=o.lastIndex-h[Dt].length;l=h[Xe];o=h[Ke]===void 0?R:h[Ke]==='"'?Ze:Ye}}else if(o===Ze||o===Ye){o=R}else if(o===Ge||o===Je){o=q}else{o=R;i=void 0}}const m=o===R&&r[a+1].startsWith("/>")?" ":"";n+=o===q?u+St:f>=0?(s.push(l),u.slice(0,f)+tt+u.slice(f))+P+m:u+P+(f===-2?a:m)}const c=n+(r[t]||"<?>")+(e===ee?"</svg>":"");return[ct(r,c),s]};var re=class r{constructor({strings:e,["_$camiType$"]:t},s){this.parts=[];let n;let i=0;let o=0;const c=e.length-1;const a=this.parts;const[u,f]=zt(e,t);this.el=r.createElement(u,s);V.currentNode=this.el.content;if(t===ee){const l=this.el.content.firstChild;l.replaceWith(...l.childNodes)}while((n=V.nextNode())!==null&&a.length<c){if(n.nodeType===1){if(n.hasAttributes()){for(const l of n.getAttributeNames()){if(l.endsWith(tt)){const d=f[o++];const h=n.getAttribute(l);const m=h.split(P);const U=/([.?@])?(.*)/.exec(d);a.push({type:Ee,index:i,name:U[2],strings:m,ctor:U[1]==="."?we:U[1]==="?"?ge:U[1]==="@"?xe:L});n.removeAttribute(l)}else if(l.startsWith(P)){a.push({type:$e,index:i});n.removeAttribute(l)}}}if(nt.test(n.tagName)){const l=n.textContent.split(P);const d=l.length-1;if(d>0){n.textContent=Z?Z.emptyScript:"";for(let h=0;h<d;h++){n.append(l[h],B());V.nextNode();a.push({type:te,index:++i})}n.append(l[d],B())}}}else if(n.nodeType===8){const l=n.data;if(l===rt){a.push({type:te,index:i})}else{let d=-1;while((d=n.data.indexOf(P,d+1))!==-1){a.push({type:Nt,index:i});d+=P.length-1}}}i++}}static createElement(e,t){const s=M.createElement("template");s.innerHTML=e;return s}};function H(r,e,t=r,s){var o,c,a;if(e===J){return e}let n=s!==void 0?(o=t.__directives)==null?void 0:o[s]:t.__directive;const i=G(e)?void 0:e["_$camiDirective$"];if((n==null?void 0:n.constructor)!==i){(c=n==null?void 0:n["_$notifyDirectiveConnectionChanged"])==null?void 0:c.call(n,false);if(i===void 0){n=void 0}else{n=new i(r);n._$initialize(r,t,s)}if(s!==void 0){((a=t.__directives)!=null?a:t.__directives=[])[s]=n}else{t.__directive=n}}if(n!==void 0){e=H(r,n._$resolve(r,e.values),n,s)}return e}var ye=class{constructor(e,t){this._$parts=[];this._$disconnectableChildren=void 0;this._$template=e;this._$parent=t}get parentNode(){return this._$parent.parentNode}get _$isConnected(){return this._$parent._$isConnected}_clone(e){var u;const{el:{content:t},parts:s}=this._$template;const n=((u=e==null?void 0:e.creationScope)!=null?u:M).importNode(t,true);V.currentNode=n;let i=V.nextNode();let o=0;let c=0;let a=s[0];while(a!==void 0){if(o===a.index){let f;if(a.type===te){f=new se(i,i.nextSibling,this,e)}else if(a.type===Ee){f=new a.ctor(i,a.name,a.strings,this,e)}else if(a.type===$e){f=new ve(i,this,e)}this._$parts.push(f);a=s[++c]}if(o!==(a==null?void 0:a.index)){i=V.nextNode();o++}}V.currentNode=M;return n}_update(e){let t=0;for(const s of this._$parts){if(s!==void 0){if(s.strings!==void 0){s._$setValue(e,s,t);t+=s.strings.length-2}else{s._$setValue(e[t])}}t++}}};var se=class r{get _$isConnected(){var e,t;return(t=(e=this._$parent)==null?void 0:e._$isConnected)!=null?t:this.__isConnected}constructor(e,t,s,n){var i;this.type=te;this._$committedValue=p;this._$disconnectableChildren=void 0;this._$startNode=e;this._$endNode=t;this._$parent=s;this.options=n;this.__isConnected=(i=n==null?void 0:n.isConnected)!=null?i:true}get parentNode(){let e=$(this._$startNode).parentNode;const t=this._$parent;if(t!==void 0&&(e==null?void 0:e.nodeType)===11){e=t.parentNode}return e}get startNode(){return this._$startNode}get endNode(){return this._$endNode}_$setValue(e,t=this){e=H(this,e,t);if(G(e)){if(e===p||e==null||e===""){if(this._$committedValue!==p){this._$clear()}this._$committedValue=p}else if(e!==this._$committedValue&&e!==J){this._commitText(e)}}else if(e["_$camiType$"]!==void 0){this._commitTemplateResult(e)}else if(e.nodeType!==void 0){this._commitNode(e)}else if(At(e)){this._commitIterable(e)}else{this._commitText(e)}}_insert(e){return $($(this._$startNode).parentNode).insertBefore(e,this._$endNode)}_commitNode(e){if(this._$committedValue!==e){this._$clear();this._$committedValue=this._insert(e)}}_commitText(e){if(this._$committedValue!==p&&G(this._$committedValue)){const t=$(this._$startNode).nextSibling;t.data=e}else{{this._commitNode(M.createTextNode(e))}}this._$committedValue=e}_commitTemplateResult(e){var i;const{values:t,["_$camiType$"]:s}=e;const n=typeof s==="number"?this._$getTemplate(e):(s.el===void 0&&(s.el=re.createElement(ct(s.h,s.h[0]),this.options)),s);if(((i=this._$committedValue)==null?void 0:i._$template)===n){this._$committedValue._update(t)}else{const o=new ye(n,this);const c=o._clone(this.options);o._update(t);this._commitNode(c);this._$committedValue=o}}_$getTemplate(e){let t=et.get(e.strings);if(t===void 0){et.set(e.strings,t=new re(e))}return t}_commitIterable(e){if(!st(this._$committedValue)){this._$committedValue=[];this._$clear()}const t=this._$committedValue;let s=0;let n;for(const i of e){if(s===t.length){t.push(n=new r(this._insert(B()),this._insert(B()),this,this.options))}else{n=t[s]}n._$setValue(i);s++}if(s<t.length){this._$clear(n&&$(n._$endNode).nextSibling,s);t.length=s}}_$clear(e=$(this._$startNode).nextSibling,t){var s;(s=this._$notifyConnectionChanged)==null?void 0:s.call(this,false,true,t);while(e&&e!==this._$endNode){const n=$(e).nextSibling;$(e).remove();e=n}}setConnected(e){var t;if(this._$parent===void 0){this.__isConnected=e;(t=this._$notifyConnectionChanged)==null?void 0:t.call(this,e)}}};var L=class{get tagName(){return this.element.tagName}get _$isConnected(){return this._$parent._$isConnected}constructor(e,t,s,n,i){this.type=Ee;this._$committedValue=p;this._$disconnectableChildren=void 0;this.element=e;this.name=t;this._$parent=n;this.options=i;if(s.length>2||s[0]!==""||s[1]!==""){this._$committedValue=new Array(s.length-1).fill(new String);this.strings=s}else{this._$committedValue=p}}_$setValue(e,t=this,s,n){const i=this.strings;let o=false;if(i===void 0){e=H(this,e,t,0);o=!G(e)||e!==this._$committedValue&&e!==J;if(o){this._$committedValue=e}}else{const c=e;e=i[0];let a,u;for(a=0;a<i.length-1;a++){u=H(this,c[s+a],t,a);if(u===J){u=this._$committedValue[a]}o||(o=!G(u)||u!==this._$committedValue[a]);if(u===p){e=p}else if(e!==p){e+=(u!=null?u:"")+i[a+1]}this._$committedValue[a]=u}}if(o&&!n){this._commitValue(e)}}_commitValue(e){if(e===p){$(this.element).removeAttribute(this.name)}else{$(this.element).setAttribute(this.name,e!=null?e:"")}}};var we=class extends L{constructor(){super(...arguments);this.type=Vt}_commitValue(e){this.element[this.name]=e===p?void 0:e}};var ge=class extends L{constructor(){super(...arguments);this.type=Mt}_commitValue(e){$(this.element).toggleAttribute(this.name,!!e&&e!==p)}};var xe=class extends L{constructor(e,t,s,n,i){super(e,t,s,n,i);this.type=It}_$setValue(e,t=this){var o;e=(o=H(this,e,t,0))!=null?o:p;if(e===J){return}const s=this._$committedValue;const n=e===p&&s!==p||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive;const i=e!==p&&(s===p||n);if(n){this.element.removeEventListener(this.name,this,s)}if(i){this.element.addEventListener(this.name,this,e)}this._$committedValue=e}handleEvent(e){var t,s;if(typeof this._$committedValue==="function"){this._$committedValue.call((s=(t=this.options)==null?void 0:t.host)!=null?s:this.element,e)}else{this._$committedValue.handleEvent(e)}}};var ve=class{constructor(e,t,s){this.element=e;this.type=$e;this._$disconnectableChildren=void 0;this._$parent=t;this.options=s}get _$isConnected(){return this._$parent._$isConnected}_$setValue(e){H(this,e)}};var Oe=(r,e,t)=>{var i,o;const s=(i=t==null?void 0:t.renderBefore)!=null?i:e;let n=s["_$camiPart$"];if(n===void 0){const c=(o=t==null?void 0:t.renderBefore)!=null?o:null;s["_$camiPart$"]=n=new se(e.insertBefore(B(),c),c,void 0,t!=null?t:{})}n._$setValue(r);return n};var dt=Symbol.for("immer-nothing");var at=Symbol.for("immer-draftable");var y=Symbol.for("immer-state");var Ut=true?[function(r){return`The plugin for '${r}' has not been loaded into Immer. To enable the plugin, import and call \`enable${r}()\` when initializing your application.`},function(r){return`produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '${r}'`},"This object has been frozen and should not be mutated",function(r){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+r},"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.","Cami Observables forbid circular references","The first or second argument to `produce` must be a function","The third argument to `produce` must be a function or undefined","First argument to `createDraft` must be a plain object, an array, or an immerable object","First argument to `finishDraft` must be a draft returned by `createDraft`",function(r){return`'current' expects a draft, got: ${r}`},"Object.defineProperty() cannot be used on a Cami Observable draft","Object.setPrototypeOf() cannot be used on a Cami Observable draft","Cami Observables only support deleting array indices","Cami Observables only support setting array indices and the 'length' property",function(r){return`'original' expects a draft, got: ${r}`}]:[];function b(r,...e){if(true){const t=Ut[r];const s=typeof t==="function"?t.apply(null,e):t;throw new Error(`[Cami.js] ${s}`)}throw new Error(`[Cami.js] minified error nr: ${r}.`)}var W=Object.getPrototypeOf;function Q(r){return!!r&&!!r[y]}function N(r){var e;if(!r)return false;return _t(r)||Array.isArray(r)||!!r[at]||!!((e=r.constructor)==null?void 0:e[at])||ce(r)||ae(r)}var kt=Object.prototype.constructor.toString();function _t(r){if(!r||typeof r!=="object")return false;const e=W(r);if(e===null){return true}const t=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;if(t===Object)return true;return typeof t=="function"&&Function.toString.call(t)===kt}function X(r,e){if(oe(r)===0){Object.entries(r).forEach(([t,s])=>{e(t,s,r)})}else{r.forEach((t,s)=>e(s,t,r))}}function oe(r){const e=r[y];return e?e.type_:Array.isArray(r)?1:ce(r)?2:ae(r)?3:0}function Te(r,e){return oe(r)===2?r.has(e):Object.prototype.hasOwnProperty.call(r,e)}function pt(r,e,t){const s=oe(r);if(s===2)r.set(e,t);else if(s===3){r.add(t)}else r[e]=t}function Ht(r,e){if(r===e){return r!==0||1/r===1/e}else{return r!==r&&e!==e}}function ce(r){return r instanceof Map}function ae(r){return r instanceof Set}function I(r){return r.copy_||r.base_}function Ce(r,e){if(ce(r)){return new Map(r)}if(ae(r)){return new Set(r)}if(Array.isArray(r))return Array.prototype.slice.call(r);if(!e&&_t(r)){if(!W(r)){const n=Object.create(null);return Object.assign(n,r)}return T({},r)}const t=Object.getOwnPropertyDescriptors(r);delete t[y];let s=Reflect.ownKeys(t);for(let n=0;n<s.length;n++){const i=s[n];const o=t[i];if(o.writable===false){o.writable=true;o.configurable=true}if(o.get||o.set)t[i]={configurable:true,writable:true,enumerable:o.enumerable,value:r[i]}}return Object.create(W(r),t)}function Ve(r,e=false){if(ue(r)||Q(r)||!N(r))return r;if(oe(r)>1){r.set=r.add=r.clear=r.delete=Lt}Object.freeze(r);if(e)X(r,(t,s)=>Ve(s,true),true);return r}function Lt(){b(2)}function ue(r){return Object.isFrozen(r)}var Wt={};function F(r){const e=Wt[r];if(!e){b(0,r)}return e}var K;function mt(){return K}function Qt(r,e){return{drafts_:[],parent_:r,immer_:e,canAutoFreeze_:true,unfinalizedDrafts_:0}}function ut(r,e){if(e){F("Patches");r.patches_=[];r.inversePatches_=[];r.patchListener_=e}}function Pe(r){je(r);r.drafts_.forEach(qt);r.drafts_=null}function je(r){if(r===K){K=r.parent_}}function lt(r){return K=Qt(K,r)}function qt(r){const e=r[y];if(e.type_===0||e.type_===1)e.revoke_();else e.revoked_=true}function ht(r,e){e.unfinalizedDrafts_=e.drafts_.length;const t=e.drafts_[0];const s=r!==void 0&&r!==t;if(s){if(t[y].modified_){Pe(e);b(4)}if(N(r)){r=ne(e,r);if(!e.parent_)ie(e,r)}if(e.patches_){F("Patches").generateReplacementPatches_(t[y].base_,r,e.patches_,e.inversePatches_)}}else{r=ne(e,t,[])}Pe(e);if(e.patches_){e.patchListener_(e.patches_,e.inversePatches_)}return r!==dt?r:void 0}function ne(r,e,t){if(ue(e))return e;const s=e[y];if(!s){X(e,(n,i)=>ft(r,s,e,n,i,t),true);return e}if(s.scope_!==r)return e;if(!s.modified_){ie(r,s.base_,true);return s.base_}if(!s.finalized_){s.finalized_=true;s.scope_.unfinalizedDrafts_--;const n=s.copy_;let i=n;let o=false;if(s.type_===3){i=new Set(n);n.clear();o=true}X(i,(c,a)=>ft(r,s,n,c,a,t,o));ie(r,n,false);if(t&&r.patches_){F("Patches").generatePatches_(s,t,r.patches_,r.inversePatches_)}}return s.copy_}function ft(r,e,t,s,n,i,o){if(n===t)b(5);if(Q(n)){const c=i&&e&&e.type_!==3&&!Te(e.assigned_,s)?i.concat(s):void 0;const a=ne(r,n,c);pt(t,s,a);if(Q(a)){r.canAutoFreeze_=false}else return}else if(o){t.add(n)}if(N(n)&&!ue(n)){if(!r.immer_.autoFreeze_&&r.unfinalizedDrafts_<1){return}ne(r,n);if(!e||!e.scope_.parent_)ie(r,n)}}function ie(r,e,t=false){if(!r.parent_&&r.immer_.autoFreeze_&&r.canAutoFreeze_){Ve(e,t)}}function Bt(r,e){const t=Array.isArray(r);const s={type_:t?1:0,scope_:e?e.scope_:mt(),modified_:false,finalized_:false,assigned_:{},parent_:e,base_:r,draft_:null,copy_:null,revoke_:null,isManual_:false};let n=s;let i=Me;if(t){n=[s];i=Y}const{revoke:o,proxy:c}=Proxy.revocable(n,i);s.draft_=c;s.revoke_=o;return c}var Me={get(r,e){if(e===y)return r;const t=I(r);if(!Te(t,e)){return Gt(r,t,e)}const s=t[e];if(r.finalized_||!N(s)){return s}if(s===Se(r.base_,e)){Ae(r);return r.copy_[e]=Re(s,r)}return s},has(r,e){return e in I(r)},ownKeys(r){return Reflect.ownKeys(I(r))},set(r,e,t){const s=bt(I(r),e);if(s==null?void 0:s.set){s.set.call(r.draft_,t);return true}if(!r.modified_){const n=Se(I(r),e);const i=n==null?void 0:n[y];if(i&&i.base_===t){r.copy_[e]=t;r.assigned_[e]=false;return true}if(Ht(t,n)&&(t!==void 0||Te(r.base_,e)))return true;Ae(r);De(r)}if(r.copy_[e]===t&&(t!==void 0||e in r.copy_)||Number.isNaN(t)&&Number.isNaN(r.copy_[e]))return true;r.copy_[e]=t;r.assigned_[e]=true;return true},deleteProperty(r,e){if(Se(r.base_,e)!==void 0||e in r.base_){r.assigned_[e]=false;Ae(r);De(r)}else{delete r.assigned_[e]}if(r.copy_){delete r.copy_[e]}return true},getOwnPropertyDescriptor(r,e){const t=I(r);const s=Reflect.getOwnPropertyDescriptor(t,e);if(!s)return s;return{writable:true,configurable:r.type_!==1||e!=="length",enumerable:s.enumerable,value:t[e]}},defineProperty(){b(11)},getPrototypeOf(r){return W(r.base_)},setPrototypeOf(){b(12)}};var Y={};X(Me,(r,e)=>{Y[r]=function(){arguments[0]=arguments[0][0];return e.apply(this,arguments)}});Y.deleteProperty=function(r,e){if(isNaN(parseInt(e)))b(13);return Y.set.call(this,r,e,void 0)};Y.set=function(r,e,t){if(e!=="length"&&isNaN(parseInt(e)))b(14);return Me.set.call(this,r[0],e,t,r[0])};function Se(r,e){const t=r[y];const s=t?I(t):r;return s[e]}function Gt(r,e,t){var n;const s=bt(e,t);return s?`value`in s?s.value:(n=s.get)==null?void 0:n.call(r.draft_):void 0}function bt(r,e){if(!(e in r))return void 0;let t=W(r);while(t){const s=Object.getOwnPropertyDescriptor(t,e);if(s)return s;t=W(t)}return void 0}function De(r){if(!r.modified_){r.modified_=true;if(r.parent_){De(r.parent_)}}}function Ae(r){if(!r.copy_){r.copy_=Ce(r.base_,r.scope_.immer_.useStrictShallowCopy_)}}var Jt=class{constructor(r){this.autoFreeze_=true;this.useStrictShallowCopy_=false;this.produce=(e,t,s)=>{if(typeof e==="function"&&typeof t!=="function"){const i=t;t=e;const o=this;return function c(a=i,...u){return o.produce(a,f=>t.call(this,f,...u))}}if(typeof t!=="function")b(6);if(s!==void 0&&typeof s!=="function")b(7);let n;if(N(e)){const i=lt(this);const o=Re(e,void 0);let c=true;try{n=t(o);c=false}finally{if(c)Pe(i);else je(i)}ut(i,s);return ht(n,i)}else if(!e||typeof e!=="object"){n=t(e);if(n===void 0)n=e;if(n===dt)n=void 0;if(this.autoFreeze_)Ve(n,true);if(s){const i=[];const o=[];F("Patches").generateReplacementPatches_(e,n,i,o);s(i,o)}return n}else b(1,e)};this.produceWithPatches=(e,t)=>{if(typeof e==="function"){return(o,...c)=>this.produceWithPatches(o,a=>e(a,...c))}let s,n;const i=this.produce(e,t,(o,c)=>{s=o;n=c});return[i,s,n]};if(typeof(r==null?void 0:r.autoFreeze)==="boolean")this.setAutoFreeze(r.autoFreeze);if(typeof(r==null?void 0:r.useStrictShallowCopy)==="boolean")this.setUseStrictShallowCopy(r.useStrictShallowCopy)}createDraft(r){if(!N(r))b(8);if(Q(r))r=Xt(r);const e=lt(this);const t=Re(r,void 0);t[y].isManual_=true;je(e);return t}finishDraft(r,e){const t=r&&r[y];if(!t||!t.isManual_)b(9);const{scope_:s}=t;ut(s,e);return ht(void 0,s)}setAutoFreeze(r){this.autoFreeze_=r}setUseStrictShallowCopy(r){this.useStrictShallowCopy_=r}applyPatches(r,e){let t;for(t=e.length-1;t>=0;t--){const n=e[t];if(n.path.length===0&&n.op==="replace"){r=n.value;break}}if(t>-1){e=e.slice(t+1)}const s=F("Patches").applyPatches_;if(Q(r)){return s(r,e)}return this.produce(r,n=>s(n,e))}};function Re(r,e){const t=ce(r)?F("MapSet").proxyMap_(r,e):ae(r)?F("MapSet").proxySet_(r,e):Bt(r,e);const s=e?e.scope_:mt();s.drafts_.push(t);return t}function Xt(r){if(!Q(r))b(10,r);return yt(r)}function yt(r){if(!N(r)||ue(r))return r;const e=r[y];let t;if(e){if(!e.modified_)return e.base_;e.finalized_=true;t=Ce(r,e.scope_.immer_.useStrictShallowCopy_)}else{t=Ce(r,true)}X(t,(s,n)=>{pt(t,s,yt(n))});if(e){e.finalized_=false}return t}var Kt=new Jt;var C=Kt.produce;var Ie=class{constructor(e){if(typeof e==="function"){this.observer={next:e}}else{this.observer=e}this.teardowns=[];if(typeof AbortController!=="undefined"){this.controller=new AbortController;this.signal=this.controller.signal}this.isUnsubscribed=false}next(e){if(!this.isUnsubscribed&&this.observer.next){this.observer.next(e)}}complete(){if(!this.isUnsubscribed){if(this.observer.complete){this.observer.complete()}this.unsubscribe()}}error(e){if(!this.isUnsubscribed){if(this.observer.error){this.observer.error(e)}this.unsubscribe()}}addTeardown(e){this.teardowns.push(e)}unsubscribe(){if(!this.isUnsubscribed){this.isUnsubscribed=true;if(this.controller){this.controller.abort()}this.teardowns.forEach(e=>{if(typeof e!=="function"){throw new Error("[Cami.js] Teardown must be a function. Please implement a teardown function in your subscriber.")}e()})}}};var w=class{constructor(e=()=>()=>{}){this.__observers=[];this.subscribeCallback=e}subscribe(e=()=>{},t=()=>{},s=()=>{}){let n;if(typeof e==="function"){n={next:e,error:t,complete:s}}else if(typeof e==="object"){n=e}else{throw new Error("[Cami.js] First argument to subscribe must be a next callback or an observer object")}const i=new Ie(n);let o=()=>{};try{o=this.subscribeCallback(i)}catch(c){if(i.error){i.error(c)}else{console.error("[Cami.js] Error in Subscriber:",c)}return}i.addTeardown(o);this.__observers.push(i);return{unsubscribe:()=>i.unsubscribe(),complete:()=>i.complete(),error:c=>i.error(c)}}next(e){this.__observers.forEach(t=>{t.next(e)})}error(e){this.__observers.forEach(t=>{t.error(e)})}complete(){this.__observers.forEach(e=>{e.complete()})}onValue(e){return this.subscribe({next:e})}onError(e){return this.subscribe({error:e})}onEnd(e){return this.subscribe({complete:e})}[Symbol.asyncIterator](){let e;let t;let s=new Promise(n=>t=n);e={next:n=>{t({value:n,done:false});s=new Promise(i=>t=i)},complete:()=>{t({done:true})},error:n=>{throw n}};this.subscribe(e);return{next:()=>s}}};var j={events:{__state:true,get isEnabled(){return this.__state},enable:function(){this.__state=true},disable:function(){this.__state=false}},debug:{__state:false,get isEnabled(){return this.__state},enable:function(){console.log("Cami.js debug mode enabled");this.__state=true},disable:function(){this.__state=false}}};function _(r,...e){if(j.debug.isEnabled){if(r==="cami:state:change"){console.groupCollapsed(`%c[${r}]`,"color: #666666; padding: 1px 3px; border: 1px solid #bbbbbb; border-radius: 2px; font-size: 90%; display: inline-block;",`${e[0]} changed`);console.log(`oldValue:`,e[1]);console.log(`newValue:`,e[2])}else{console.groupCollapsed(`%c[${r}]`,"color: #666666; padding: 1px 3px; border: 1px solid #bbbbbb; border-radius: 2px; font-size: 90%; display: inline-block;",...e)}console.trace();console.groupEnd()}}var z=class extends w{constructor(e){if(typeof e!=="object"||e===null){throw new TypeError("[Cami.js] initialState must be an object")}super(t=>{this.__subscriber=t;return()=>{this.__subscriber=null}});this.state=new Proxy(e,{get:(t,s)=>{return t[s]},set:(t,s,n)=>{t[s]=n;this.__observers.forEach(i=>i.next(this.state));if(this.devTools){this.devTools.send(s,this.state)}return true}});this.reducers={};this.middlewares=[];this.devTools=this.__connectToDevTools();this.dispatchQueue=[];this.isDispatching=false;this.queryCache=new Map;this.queryFunctions=new Map;this.queries={};this.intervals=new Map;this.focusHandlers=new Map;this.reconnectHandlers=new Map;this.gcTimeouts=new Map;Object.keys(e).forEach(t=>{if(typeof e[t]==="function"){this.register(t,e[t])}else{this.state[t]=e[t]}})}__applyMiddleware(e,...t){const s={state:this.state,action:e,payload:t};for(const n of this.middlewares){n(s)}}__connectToDevTools(){if(typeof window!=="undefined"&&window["__REDUX_DEVTOOLS_EXTENSION__"]){const e=window["__REDUX_DEVTOOLS_EXTENSION__"].connect();e.init(this.state);return e}return null}use(e){this.middlewares.push(e)}getState(){return this.state}register(e,t){if(this.reducers[e]){throw new Error(`[Cami.js] Action type ${e} is already registered.`)}this.reducers[e]=t;this[e]=(...s)=>{this.dispatch(e,...s)}}query(e,t){const{queryKey:s,queryFn:n,staleTime:i=0,refetchOnWindowFocus:o=true,refetchInterval:c=null,refetchOnReconnect:a=true,gcTime:u=1e3*60*5,retry:f=3,retryDelay:l=h=>Math.pow(2,h)*1e3}=t;this.queries[e]={queryKey:s,queryFn:n,staleTime:i,refetchOnWindowFocus:o,refetchInterval:c,refetchOnReconnect:a,gcTime:u,retry:f,retryDelay:l};this.queryFunctions.set(s,n);_(`query`,`Starting query with key: ${e}`);if(c!==null){const h=setInterval(()=>{_(`query`,`Interval expired, refetching query: ${e}`);this.fetch(e).catch(m=>console.error(`Error refetching query ${e}:`,m))},c);this.intervals[e]=h}if(o){const h=()=>{_(`query`,`Window focus detected, refetching query: ${e}`);this.fetch(e).catch(m=>console.error(`Error refetching query ${e} on window focus:`,m))};window.addEventListener("focus",h);this.focusHandlers[e]=h}if(a){const h=()=>{_(`query`,`Reconnect detected, refetching query: ${e}`);this.fetch(e).catch(m=>console.error(`Error refetching query ${e} on reconnect:`,m))};window.addEventListener("online",h);this.reconnectHandlers[e]=h}const d=setTimeout(()=>{_(`query`,`Garbage collection timeout expired, refetching query: ${e}`);this.fetch(e).catch(h=>console.error(`Error refetching query ${e} on gc timeout:`,h))},u);this.gcTimeouts[e]=d;this[e]=(...h)=>{return this.fetch(e,...h)}}fetch(e,...t){const s=this.queries[e];if(!s){throw new Error(`[Cami.js] No query found for name: ${e}`)}const{queryKey:n,queryFn:i,staleTime:o,retry:c,retryDelay:a}=s;const u=Array.isArray(n)?n.join(":"):n;const f=this.queryCache.get(u);if(f&&!this._isStale(f,o)){_(`fetch`,`Returning cached data for: ${e} with cacheKey: ${u}`);return Promise.resolve(f.data)}_(`fetch`,`Data is stale or not cached, fetching new data for: ${e}`);this.dispatch(`${e}/pending`);return this._fetchWithRetry(i,t,c,a).then(l=>{this.queryCache.set(u,{data:l,timestamp:Date.now()});this.dispatch(`${e}/success`,l);return l}).catch(l=>{this.dispatch(`${e}/error`,l);throw l})}invalidateQueries(e){const t=this.queries[e];if(!t)return;const s=Array.isArray(t.queryKey)?t.queryKey.join(":"):t.queryKey;_(`invalidateQueries`,`Invalidating query with key: ${e}`);if(this.intervals[e]){clearInterval(this.intervals[e]);delete this.intervals[e]}if(this.focusHandlers[e]){window.removeEventListener("focus",this.focusHandlers[e]);delete this.focusHandlers[e]}if(this.reconnectHandlers[e]){window.removeEventListener("online",this.reconnectHandlers[e]);delete this.reconnectHandlers[e]}if(this.gcTimeouts[e]){clearTimeout(this.gcTimeouts[e]);delete this.gcTimeouts[e]}this.queryCache.delete(s)}_fetchWithRetry(e,t,s,n){return e(...t).catch(i=>{if(s===0){throw i}const o=n(s);return new Promise(c=>setTimeout(c,o)).then(()=>_(`fetchWithRetry`,`Retrying query with key: ${queryName}`),this._fetchWithRetry(e,t,s-1,n))})}_isStale(e,t){const s=Date.now()-e.timestamp>t;_(`isStale`,`isDataStale: ${s} (Current Time: ${Date.now()}, Data Timestamp: ${e.timestamp}, Stale Time: ${t})`);return s}dispatch(e,t){this.dispatchQueue.push({action:e,payload:t});if(!this.isDispatching){this._processDispatchQueue()}}_processDispatchQueue(){while(this.dispatchQueue.length>0){const{action:e,payload:t}=this.dispatchQueue.shift();this.isDispatching=true;this._dispatch(e,t);this.isDispatching=false}}_dispatch(e,t){if(typeof e==="function"){return e(this._dispatch.bind(this),()=>this.state)}if(typeof e!=="string"){throw new Error(`[Cami.js] Action type must be a string. Got: ${typeof e}`)}const s=this.reducers[e];if(!s){console.warn(`No reducer found for action ${e}`);return}this.__applyMiddleware(e,t);const n=this.state;const i=C(this.state,o=>{s(o,t)});this.state=i;this.__observers.forEach(o=>o.next(this.state));if(this.devTools){this.devTools.send(e,this.state)}if(n!==i){if(j.events.isEnabled&&typeof window!=="undefined"){const o=new CustomEvent("cami:store:state:change",{detail:{action:e,oldValue:n,newValue:i}});window.dispatchEvent(o)}_("cami:store:state:change",e,n,i)}}};var Yt=(r,{name:e,state:t,actions:s})=>{if(r.slices&&r.slices[e]){throw new Error(`[Cami.js] Slice name ${e} is already in use.`)}if(!r.slices){r.slices={}}r.slices[e]=true;r.state[e]=t;const n={};const i=[];Object.keys(s).forEach(a=>{const u=`${e}/${a}`;r.register(u,(f,l)=>{s[a](f[e],l)});n[a]=(...f)=>{r.dispatch(u,...f)}});const o=a=>{i.push(a);return()=>{const u=i.indexOf(a);if(u>-1){i.splice(u,1)}}};r.subscribe(a=>{const u=a[e];i.forEach(f=>f(u))});const c=()=>{return r.getState()[e]};return{getState:c,actions:n,subscribe:o}};var wt=function(r,e){if(typeof r!=="object"||r===null){return e}Object.keys(e).forEach(t=>{const s=r[t];const n=e[t];if(Array.isArray(s)&&Array.isArray(n)){r[t]=[...s,...n]}else if(typeof s==="object"&&s!==null&&typeof n==="object"&&n!==null){r[t]=wt(T({},s),n)}else{r[t]=n}});Object.keys(r).forEach(t=>{if(!e.hasOwnProperty(t)){r[t]=r[t]}});return r};var Zt=r=>{return(e,t)=>{const s=(t==null?void 0:t.name)||"default-store";const n=(t==null?void 0:t.load)!==false;const i=24*60*60*1e3;const o=(t==null?void 0:t.expiry)!==void 0?t.expiry:i;const c=new r(e);c.init=()=>{if(n){const a=localStorage.getItem(s);const u=localStorage.getItem(`${s}-expiry`);const f=new Date().getTime();if(a&&u){const l=f>=parseInt(u,10);if(!l){const d=JSON.parse(a);c.state=wt(e,d)}else{localStorage.removeItem(s);localStorage.removeItem(`${s}-expiry`)}}}};c.init();c.reset=()=>{localStorage.removeItem(s);localStorage.removeItem(`${s}-expiry`);c.state=e;c.__observers.forEach(a=>a.next(c.state))};c.subscribe(a=>{const u=new Date().getTime();const f=u+o;localStorage.setItem(s,JSON.stringify(a));localStorage.setItem(`${s}-expiry`,f.toString())});return c}};var er=(r,e={})=>{const t={localStorage:true,name:"cami-store",expiry:864e5};const s=T(T({},t),e);if(s.localStorage){const n=Zt(z)(r,s);return n}else{return new z(r)}};var E=class r extends w{static from(e){if(e instanceof w){return new r(t=>{const s=e.subscribe({next:n=>t.next(n),error:n=>t.error(n),complete:()=>t.complete()});return()=>{if(!s.closed){s.unsubscribe()}}})}else if(e[Symbol.asyncIterator]){return new r(t=>{let s=false;(()=>k(this,null,function*(){try{try{for(var n=pe(e),i,o,c;i=!(o=yield n.next()).done;i=false){const a=o.value;if(s)return;t.next(a)}}catch(o){c=[o]}finally{try{i&&(o=n.return)&&(yield o.call(n))}finally{if(c)throw c[0]}}t.complete()}catch(a){t.error(a)}}))();return()=>{s=true}})}else if(e[Symbol.iterator]){return new r(t=>{try{for(const s of e){t.next(s)}t.complete()}catch(s){t.error(s)}return()=>{if(!subscription.closed){subscription.unsubscribe()}}})}else if(e instanceof Promise){return new r(t=>{e.then(s=>{t.next(s);t.complete()},s=>t.error(s));return()=>{}})}else{throw new TypeError("[Cami.js] ObservableStream.from requires an Observable, AsyncIterable, Iterable, or Promise")}}map(e){return new r(t=>{const s=this.subscribe({next:n=>t.next(e(n)),error:n=>t.error(n),complete:()=>t.complete()});return()=>s.unsubscribe()})}filter(e){return new r(t=>{const s=this.subscribe({next:n=>{if(e(n)){t.next(n)}},error:n=>t.error(n),complete:()=>t.complete()});return()=>s.unsubscribe()})}reduce(e,t){return new Promise((s,n)=>{let i=t;const o=this.subscribe({next:c=>{i=e(i,c)},error:c=>n(c),complete:()=>s(i)});return()=>o.unsubscribe()})}takeUntil(e){return new r(t=>{const s=this.subscribe({next:i=>t.next(i),error:i=>t.error(i),complete:()=>t.complete()});const n=e.subscribe({next:()=>{t.complete();s.unsubscribe();n.unsubscribe()},error:i=>t.error(i)});return()=>{s.unsubscribe();n.unsubscribe()}})}take(e){return new r(t=>{let s=0;const n=this.subscribe({next:i=>{if(s++<e){t.next(i)}else{t.complete();n.unsubscribe()}},error:i=>t.error(i),complete:()=>t.complete()});return()=>n.unsubscribe()})}drop(e){return new r(t=>{let s=0;const n=this.subscribe({next:i=>{if(s++>=e){t.next(i)}},error:i=>t.error(i),complete:()=>t.complete()});return()=>n.unsubscribe()})}flatMap(e){return new r(t=>{const s=new Set;const n=this.subscribe({next:i=>{const o=e(i);const c=o.subscribe({next:a=>t.next(a),error:a=>t.error(a),complete:()=>{s.delete(c);if(s.size===0){t.complete()}}});s.add(c)},error:i=>t.error(i),complete:()=>{if(s.size===0){t.complete()}}});return()=>{n.unsubscribe();s.forEach(i=>i.unsubscribe())}})}switchMap(e){return new r(t=>{let s=null;const n=this.subscribe({next:i=>{if(s){s.unsubscribe()}const o=e(i);s=o.subscribe({next:c=>t.next(c),error:c=>t.error(c),complete:()=>{if(s){s.unsubscribe();s=null}}})},error:i=>t.error(i),complete:()=>{if(s){s.unsubscribe()}t.complete()}});return()=>{n.unsubscribe();if(s){s.unsubscribe()}}})}toArray(){return new Promise((e,t)=>{const s=[];this.subscribe({next:n=>s.push(n),error:n=>t(n),complete:()=>e(s)})})}forEach(e){return new Promise((t,s)=>{this.subscribe({next:n=>e(n),error:n=>s(n),complete:()=>t()})})}every(e){return new Promise((t,s)=>{let n=true;this.subscribe({next:i=>{if(!e(i)){n=false;t(false)}},error:i=>s(i),complete:()=>t(n)})})}find(e){return new Promise((t,s)=>{const n=this.subscribe({next:i=>{if(e(i)){t(i);n.unsubscribe()}},error:i=>s(i),complete:()=>t(void 0)})})}some(e){return new Promise((t,s)=>{const n=this.subscribe({next:i=>{if(e(i)){t(true);n.unsubscribe()}},error:i=>s(i),complete:()=>t(false)})})}finally(e){return new r(t=>{const s=this.subscribe({next:n=>t.next(n),error:n=>{e();t.error(n)},complete:()=>{e();t.complete()}});return()=>{s.unsubscribe()}})}toState(e=null){const t=new g(e,null,{name:"ObservableStream"});this.subscribe({next:s=>t.update(()=>s),error:s=>t.error(s),complete:()=>t.complete()});return t}push(e){if(e instanceof w){const t=e.subscribe({next:s=>this.__observers.forEach(n=>n.next(s)),error:s=>this.__observers.forEach(n=>n.error(s)),complete:()=>this.__observers.forEach(s=>s.complete())})}else if(e[Symbol.asyncIterator]){(()=>k(this,null,function*(){try{try{for(var t=pe(e),s,n,i;s=!(n=yield t.next()).done;s=false){const o=n.value;this.__observers.forEach(c=>c.next(o))}}catch(n){i=[n]}finally{try{s&&(n=t.return)&&(yield n.call(t))}finally{if(i)throw i[0]}}this.__observers.forEach(o=>o.complete())}catch(o){this.__observers.forEach(c=>c.error(o))}}))()}else if(e[Symbol.iterator]){try{for(const t of e){this.__observers.forEach(s=>s.next(t))}this.__observers.forEach(t=>t.complete())}catch(t){this.__observers.forEach(s=>s.error(t))}}else if(e instanceof Promise){e.then(t=>{this.__observers.forEach(s=>s.next(t));this.__observers.forEach(s=>s.complete())},t=>this.__observers.forEach(s=>s.error(t)))}else{this.__observers.forEach(t=>t.next(e))}}plug(e){e.subscribe({next:t=>this.push(t),error:t=>this.__observers.forEach(s=>s.error(t)),complete:()=>this.__observers.forEach(t=>t.complete())})}end(){this.__observers.forEach(e=>{if(e&&typeof e.complete==="function"){e.complete()}})}catchError(e){return new r(t=>{const s=this.subscribe({next:n=>t.next(n),error:n=>{const i=e(n);i.subscribe({next:o=>t.next(o),error:o=>t.error(o),complete:()=>t.complete()})},complete:()=>t.complete()});return()=>s.unsubscribe()})}debounce(e){return new r(t=>{let s=null;const n=this.subscribe({next:i=>{clearTimeout(s);s=setTimeout(()=>{t.next(i)},e)},error:i=>t.error(i),complete:()=>{clearTimeout(s);t.complete()}});return()=>{clearTimeout(s);n.unsubscribe()}})}tap(e){return new r(t=>{const s=this.subscribe({next:n=>{e(n);t.next(n)},error:n=>t.error(n),complete:()=>t.complete()});return()=>s.unsubscribe()})}throttle(e){return new r(t=>{let s=0;const n=this.subscribe({next:i=>{const o=Date.now();if(o-s>e){s=o;t.next(i)}},error:i=>t.error(i),complete:()=>t.complete()});return()=>n.unsubscribe()})}distinctUntilChanged(){return new r(e=>{let t;let s=true;const n=this.subscribe({next:i=>{if(s||i!==t){s=false;t=i;e.next(i)}},error:i=>e.error(i),complete:()=>e.complete()});return()=>n.unsubscribe()})}concatMap(e){return new r(t=>{let s=null;let n=false;const i=[];const o=this.subscribe({next:c=>{if(!n){n=true;const a=e(c);s=a.subscribe({next:u=>t.next(u),error:u=>t.error(u),complete:()=>{if(i.length>0){const u=i.shift();const f=e(u);s=f.subscribe({next:l=>t.next(l),error:l=>t.error(l),complete:()=>n=false})}else{n=false}}})}else{i.push(c)}},error:c=>t.error(c),complete:()=>{if(!n){t.complete()}}});return()=>{o.unsubscribe();if(s){s.unsubscribe()}}})}combineLatest(...e){return new r(t=>{const s=new Array(e.length).fill(void 0);const n=e.map((i,o)=>i.subscribe({next:c=>{s[o]=c;if(!s.includes(void 0)){t.next([...s])}},error:c=>t.error(c),complete:()=>{}}));return()=>n.forEach(i=>i.unsubscribe())})}startWith(...e){return new r(t=>{e.forEach(n=>t.next(n));const s=this.subscribe({next:n=>t.next(n),error:n=>t.error(n),complete:()=>t.complete()});return()=>s.unsubscribe()})}};var D={current:null};var g=class extends w{constructor(e=null,t=null,{last:s=false,name:n=null}={}){super();if(s){this.__lastObserver=t}else{this.__observers.push(t)}this.__value=C(e,i=>{});this.__pendingUpdates=[];this.__updateScheduled=false;this.__name=n}get value(){if(D.current!=null){D.current.addDependency(this)}return this.__value}set value(e){this.update(()=>e)}assign(e){if(typeof this.__value!=="object"||this.__value===null){throw new Error("[Cami.js] Observable value is not an object")}this.update(t=>Object.assign(t,e))}set(e,t){if(typeof this.__value!=="object"||this.__value===null){throw new Error("[Cami.js] Observable value is not an object")}this.update(s=>{const n=e.split(".");let i=s;for(let o=0;o<n.length-1;o++){i=i[n[o]]}i[n[n.length-1]]=t})}delete(e){if(typeof this.__value!=="object"||this.__value===null){throw new Error("[Cami.js] Observable value is not an object")}this.update(t=>{const s=e.split(".");let n=t;for(let i=0;i<s.length-1;i++){n=n[s[i]]}delete n[s[s.length-1]]})}clear(){this.update(()=>({}))}push(...e){if(!Array.isArray(this.__value)){throw new Error("[Cami.js] Observable value is not an array")}this.update(t=>{t.push(...e)})}pop(){if(!Array.isArray(this.__value)){throw new Error("[Cami.js] Observable value is not an array")}this.update(e=>{e.pop()})}shift(){if(!Array.isArray(this.__value)){throw new Error("[Cami.js] Observable value is not an array")}this.update(e=>{e.shift()})}splice(e,t,...s){if(!Array.isArray(this.__value)){throw new Error("[Cami.js] Observable value is not an array")}this.update(n=>{n.splice(e,t,...s)})}unshift(...e){if(!Array.isArray(this.__value)){throw new Error("[Cami.js] Observable value is not an array")}this.update(t=>{t.unshift(...e)})}reverse(){if(!Array.isArray(this.__value)){throw new Error("[Cami.js] Observable value is not an array")}this.update(e=>{e.reverse()})}sort(e){if(!Array.isArray(this.__value)){throw new Error("[Cami.js] Observable value is not an array")}this.update(t=>{t.sort(e)})}fill(e,t=0,s=this.__value.length){if(!Array.isArray(this.__value)){throw new Error("[Cami.js] Observable value is not an array")}this.update(n=>{n.fill(e,t,s)})}copyWithin(e,t,s=this.__value.length){if(!Array.isArray(this.__value)){throw new Error("[Cami.js] Observable value is not an array")}this.update(n=>{n.copyWithin(e,t,s)})}update(e){this.__pendingUpdates.push(e);this.__scheduleupdate()}__scheduleupdate(){if(!this.__updateScheduled){this.__updateScheduled=true;this.__applyUpdates()}}__notifyObservers(){const e=[...this.__observers,this.__lastObserver];e.forEach(t=>{if(t&&typeof t==="function"){t(this.__value)}else if(t&&t.next){t.next(this.__value)}})}__applyUpdates(){let e=this.__value;while(this.__pendingUpdates.length>0){const t=this.__pendingUpdates.shift();if(typeof this.__value==="object"&&this.__value!==null&&this.__value.constructor===Object||Array.isArray(this.__value)){this.__value=C(this.__value,t)}else{this.__value=t(this.__value)}}if(e!==this.__value){this.__notifyObservers();if(j.events.isEnabled&&typeof window!=="undefined"){const t=new CustomEvent("cami:state:change",{detail:{name:this.__name,oldValue:e,newValue:this.__value}});window.dispatchEvent(t)}_("cami:state:change",this.__name,e,this.__value)}this.__updateScheduled=false}toStream(){const e=new E;this.subscribe({next:t=>e.emit(t),error:t=>e.error(t),complete:()=>e.end()});return e}complete(){this.__observers.forEach(e=>{if(e&&typeof e.complete==="function"){e.complete()}})}};var Ne=class extends g{constructor(e){super(null);this.computeFn=e;this.dependencies=new Set;this.subscriptions=new Map;this.__compute()}get value(){if(D.current){D.current.addDependency(this)}return this.__value}__compute(){const e={addDependency:s=>{if(!this.dependencies.has(s)){const n=s.onValue(()=>this.__compute());this.dependencies.add(s);this.subscriptions.set(s,n)}}};D.current=e;const t=this.computeFn();D.current=null;if(t!==this.__value){this.__value=t;this.__notifyObservers()}}dispose(){this.subscriptions.forEach(e=>{e.unsubscribe()})}};var Fe=function(r){return new Ne(r)};var ze=function(r){let e=()=>{};let t=new Set;let s=new Map;const n={addDependency:c=>{if(!t.has(c)){const a=c.onValue(i);t.add(c);s.set(c,a)}}};const i=()=>{e();D.current=n;e=r()||(()=>{});D.current=null};if(typeof window!=="undefined"){requestAnimationFrame(i)}else{setTimeout(i,0)}const o=()=>{s.forEach(c=>{c.unsubscribe()});e()};return o};var le=class{constructor(e){if(!(e instanceof g)){throw new TypeError("Expected observable to be an instance of ObservableState")}return new Proxy(e,{get:(t,s)=>{if(typeof t[s]==="function"){return t[s].bind(t)}else if(s in t){return t[s]}else if(typeof t.value[s]==="function"){return(...n)=>t.value[s](...n)}else{return t.value[s]}},set:(t,s,n)=>{t[s]=n;t.update(()=>t.value);return true}})}};var O=new Map;var Ue=class extends HTMLElement{constructor(){super();this.onCreate();this.__unsubscribers=new Map;this.__computed=Fe.bind(this);this.effect=ze.bind(this);this.__queryFunctions=new Map}observableAttributes(e){Object.entries(e).forEach(([t,s])=>{let n=this.getAttribute(t);const i=typeof s==="function"?s:c=>c;n=C(n,i);const o=this.__observable(n,t);if(this.__isObjectOrArray(o.value)){this.__createObservablePropertyForObjOrArr(this,t,o,true)}else{this.__createObservablePropertyForPrimitive(this,t,o,true)}})}__computed(e){const t=super._computed(e);console.log(t);this.__registerObservables(t);return t}effect(e){const t=super.effect(e);this.__unsubscribers.set(e,t)}connect(e,t){if(!(e instanceof z)){throw new TypeError("Expected store to be an instance of ObservableStore")}const s=this.__observable(e.state[t],t);const n=e.subscribe(i=>{s.update(()=>i[t])});this.__unsubscribers.set(t,n);if(this.__isObjectOrArray(s.value)){this.__createObservablePropertyForObjOrArr(this,t,s);return this[t]}else{this.__createObservablePropertyForPrimitive(this,t,s);return this[t]}}stream(e){return new E(e)}template(){throw new Error("[Cami.js] You have to implement the method template()!")}query({queryKey:e,queryFn:t,staleTime:s=0,refetchOnWindowFocus:n=true,refetchOnMount:i=true,refetchOnReconnect:o=true,refetchInterval:c=null,gcTime:a=1e3*60*5,retry:u=3,retryDelay:f=l=>Math.pow(2,l)*1e3}){const l=Array.isArray(e)?e.map(v=>typeof v==="object"?JSON.stringify(v):v).join(":"):e;this.__queryFunctions.set(l,t);_("query","Starting query with key:",l);const d=this.__observable({data:null,status:"pending",fetchStatus:"idle",error:null,lastUpdated:O.has(l)?O.get(l).lastUpdated:null},l);const h=this.__observableProxy(d);const m=(v=0)=>k(this,null,function*(){const He=Date.now();const fe=O.get(l);if(fe&&He-fe.lastUpdated<s){_("fetchData (if)","Using cached data for key:",l);h.update(S=>{S.data=fe.data;S.status="success";S.fetchStatus="idle"})}else{_("fetchData (else)","Fetching data for key:",l);try{h.update(A=>{A.status="pending";A.fetchStatus="fetching"});const S=yield t();O.set(l,{data:S,lastUpdated:He});h.update(A=>{A.data=S;A.status="success";A.fetchStatus="idle"})}catch(S){_("fetchData (catch)","Fetch error for key:",l,S);if(v<u){setTimeout(()=>m(v+1),f(v))}else{h.update(A=>{A.errorDetails={message:S.message,stack:S.stack};A.status="error";A.fetchStatus="idle"})}}}});if(i){_("query","Setting up refetch on mount for key:",l);m()}if(n){_("query","Setting up refetch on window focus for key:",l);const v=()=>m();window.addEventListener("focus",v);this.__unsubscribers.set(`focus:${l}`,()=>window.removeEventListener("focus",v))}if(o){_("query","Setting up refetch on reconnect for key:",l);window.addEventListener("online",m);this.__unsubscribers.set(`online:${l}`,()=>window.removeEventListener("online",m))}if(c){_("query","Setting up refetch interval for key:",l);const v=setInterval(m,c);this.__unsubscribers.set(`interval:${l}`,()=>clearInterval(v))}const U=setTimeout(()=>{O.delete(l)},a);this.__unsubscribers.set(`gc:${l}`,()=>clearTimeout(U));return h}mutation({mutationFn:e,onMutate:t,onError:s,onSuccess:n,onSettled:i}){const o=this.__observable({data:null,status:"idle",error:null,isSettled:false},"mutation");const c=this.__observableProxy(o);const a=u=>k(this,null,function*(){_("mutation","Starting mutation for variables:",u);let f;const l=c.value;if(t){_("mutation","Performing optimistic update for variables:",u);f=t(u,l);c.update(d=>{d.data=f.optimisticData;d.status="pending";d.errorDetails=null})}else{_("mutation","Performing mutation without optimistic update for variables:",u);c.update(d=>{d.status="pending";d.errorDetails=null})}try{const d=yield e(u);c.update(h=>{h.data=d;h.status="success"});if(n){n(d,u,f)}_("mutation","Mutation successful for variables:",u,d)}catch(d){_("mutation","Mutation error for variables:",u,d);c.update(h=>{h.errorDetails={message:d.message};h.status="error";if(!s&&f&&f.rollback){_("mutation","Rolling back mutation for variables:",u);f.rollback()}});if(s){s(d,u,f)}}finally{if(!c.value.isSettled){c.update(d=>{d.isSettled=true});if(i){_("mutation","Calling onSettled for variables:",u);i(c.value.data,c.value.error,u,f)}}}});c.mutate=a;c.reset=()=>{c.update(u=>{u.data=null;u.status="idle";u.errorDetails=null;u.isSettled=false})};return c}invalidateQueries(e){const t=Array.isArray(e)?e.join(":"):e;_("invalidateQueries","Invalidating query with key:",t);O.delete(t);this.__updateCache(t)}onCreate(){}connectedCallback(){this.__setup({infer:true});this.effect(()=>this.render());this.render();this.onConnect()}onConnect(){}disconnectedCallback(){this.onDisconnect();this.__unsubscribers.forEach(e=>e())}onDisconnect(){}attributeChangedCallback(e,t,s){this.onAttributeChange(e,t,s)}onAttributeChange(e,t,s){}adoptedCallback(){this.onAdopt()}onAdopt(){}__isObjectOrArray(e){return e!==null&&(typeof e==="object"||Array.isArray(e))}__createObservablePropertyForObjOrArr(e,t,s,n=false){if(!(s instanceof g)){throw new TypeError("Expected observable to be an instance of ObservableState")}const i=this.__observableProxy(s);Object.defineProperty(e,t,{get:()=>i,set:o=>{s.update(()=>o);if(n){this.setAttribute(t,o)}}})}__createObservablePropertyForPrimitive(e,t,s,n=false){if(!(s instanceof g)){throw new TypeError("Expected observable to be an instance of ObservableState")}Object.defineProperty(e,t,{get:()=>s.value,set:i=>{s.update(()=>i);if(n){this.setAttribute(t,i)}}})}__observableProxy(e){return new le(e)}__setup(e){if(e.infer===true){Object.keys(this).forEach(t=>{if(typeof this[t]!=="function"&&!t.startsWith("__")){if(this[t]instanceof w){return}else{const s=this.__observable(this[t],t);if(this.__isObjectOrArray(s.value)){this.__createObservablePropertyForObjOrArr(this,t,s)}else{this.__createObservablePropertyForPrimitive(this,t,s)}}}})}}__observable(e,t){if(!this.__isAllowedType(e)){const n=Object.prototype.toString.call(e);throw new Error(`[Cami.js] The value of type ${n} is not allowed in observables. Only primitive values, arrays, and plain objects are allowed.`)}const s=new g(e,null,{name:t});this.__registerObservables(s);return s}__updateCache(e){_("__updateCache","Invalidating cache with key:",e);const t=this.__queryFunctions.get(e);if(t){_("__updateCache","Found query function for key:",e);const s=O.get(e)||{data:void 0,status:"idle",error:null};O.set(e,_e(T({},s),{status:"pending",error:null}));t().then(n=>{O.set(e,{data:n,status:"success",error:null,lastUpdated:Date.now()});_("__updateCache","Refetch successful for key:",e,n)}).catch(n=>{if(s.data!==void 0){_("__updateCache","Rolling back refetch for key:",e);O.set(e,s)}O.set(e,_e(T({},s),{status:"error",error:n}))})}}__isAllowedType(e){const t=["number","string","boolean","object","undefined"];const s=typeof e;if(s==="object"){return e===null||Array.isArray(e)||this.__isPlainObject(e)}return t.includes(s)}__isPlainObject(e){if(Object.prototype.toString.call(e)!=="[object Object]"){return false}const t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}__registerObservables(e){if(!(e instanceof g)){throw new TypeError("Expected observableState to be an instance of ObservableState")}this.__unsubscribers.set(e,()=>{if(typeof e.dispose==="function"){e.dispose()}})}render(){const e=this.template();Oe(e,this)}};var ke=class extends E{constructor(e){super();if(typeof e==="string"){this.element=document.querySelector(e);if(!this.element){throw new Error(`[Cami.js] Element not found for selector: ${e}`)}}else if(e instanceof Element||e instanceof Document){this.element=e}else{throw new Error(`[Cami.js] Invalid argument: ${e}`)}}on(e,t={}){return new E(s=>{const n=i=>{s.next(i)};this.element.addEventListener(e,n,t);return()=>{this.element.removeEventListener(e,n,t)}})}};var he=class extends E{constructor(){super(...arguments);Qe(this,"__handlers",{})}toJson(){return new Promise((t,s)=>{this.subscribe({next:n=>{try{if(typeof n==="object"){t(n)}else{t(JSON.parse(n))}}catch(i){s(i)}},error:n=>s(n)})})}on(t,s){if(!this.__handlers[t]){this.__handlers[t]=[]}this.__handlers[t].push(s);return this}};var x=r=>{if(typeof r==="string"){return x.get(r)}return new he(e=>{const t=new XMLHttpRequest;t.open(r.method||"GET",r.url);if(r.headers){Object.keys(r.headers).forEach(s=>{t.setRequestHeader(s,r.headers[s])})}t.onload=()=>{let s=t.responseText;const n=r.transformResponse||(i=>{try{return JSON.parse(i)}catch(o){return i}});s=n(s);e.next(s);e.complete()};t.onerror=()=>e.error(t.statusText);t.send(r.data?JSON.stringify(r.data):null);return()=>{t.abort()}})};x.get=(r,e={})=>{e.url=r;e.method="GET";return x(e)};x.post=(r,e={},t={})=>{t.url=r;t.data=e;t.method="POST";return x(t)};x.put=(r,e={},t={})=>{t.url=r;t.data=e;t.method="PUT";return x(t)};x.patch=(r,e={},t={})=>{t.url=r;t.data=e;t.method="PATCH";return x(t)};x.delete=(r,e={})=>{e.url=r;e.method="DELETE";return x(e)};x.sse=(r,e={})=>{const t=new he(s=>{const n=new EventSource(r,e);n.onmessage=i=>{if(t.__handlers[i.type]){t.__handlers[i.type].forEach(o=>o(i))}s.next(i)};n.onerror=i=>s.error(i);return()=>{n.close()}});return t};var{debug:ts,events:rs}=j;export{w as Observable,ke as ObservableElement,g as ObservableState,z as ObservableStore,E as ObservableStream,Ue as ReactiveElement,Fe as computed,ts as debug,ze as effect,rs as events,ot as html,x as http,Yt as slice,er as store,Ft as svg};
/**
 * @license
 * lit-html
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
/**
 * @license
 * Immer
 * Copyright (c) 2017 Michel Weststrate
 * MIT License
 */
/**
 * @license
 * http.js
 * Copyright (c) 2023 Kenn Costales
 * MIT License
 */
/**
 * @license
 * cami.js
 * Copyright (c) 2023 Kenn Costales
 * MIT License
 */
//# sourceMappingURL=cami.module.js.map
