var ft=Object.defineProperty;var pt=Object.defineProperties;var dt=Object.getOwnPropertyDescriptors;var Me=Object.getOwnPropertySymbols;var _t=Object.prototype.hasOwnProperty;var bt=Object.prototype.propertyIsEnumerable;var Ue=(s,e)=>{if(e=Symbol[s])return e;throw Error("Symbol."+s+" is not defined")};var he=(s,e,t)=>e in s?ft(s,e,{enumerable:true,configurable:true,writable:true,value:t}):s[e]=t;var V=(s,e)=>{for(var t in e||(e={}))if(_t.call(e,t))he(s,t,e[t]);if(Me)for(var t of Me(e)){if(bt.call(e,t))he(s,t,e[t])}return s};var fe=(s,e)=>pt(s,dt(e));var ze=(s,e,t)=>{he(s,typeof e!=="symbol"?e+"":e,t);return t};var I=(s,e,t)=>{return new Promise((r,n)=>{var i=c=>{try{a(t.next(c))}catch(l){n(l)}};var o=c=>{try{a(t.throw(c))}catch(l){n(l)}};var a=c=>c.done?r(c.value):Promise.resolve(c.value).then(i,o);a((t=t.apply(s,e)).next())})};var pe=(s,e,t)=>(e=s[Ue("asyncIterator")])?e.call(s):(s=s[Ue("iterator")](),e={},t=(r,n)=>(n=s[r])&&(e[r]=i=>new Promise((o,a,c)=>(i=n.call(s,i),c=i.done,Promise.resolve(i.value).then(l=>o({value:l,done:c}),a)))),t("next"),t("return"),e);var B=globalThis;var re=B.trustedTypes;var Ie=re?re.createPolicy("lit-html",{createHTML:s=>s}):void 0;var We="$lit$";var P=`lit$${(Math.random()+"").slice(9)}$`;var Be="?"+P;var mt=`<${Be}>`;var D=document;var k=()=>D.createComment("");var Q=s=>null===s||"object"!=typeof s&&"function"!=typeof s;var ke=Array.isArray;var yt=s=>ke(s)||"function"==typeof(s==null?void 0:s[Symbol.iterator]);var de="[ 	\n\f\r]";var W=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g;var Fe=/-->/g;var He=/>/g;var C=RegExp(`>|${de}(?:([^\\s"'>=/]+)(${de}*=${de}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g");var Re=/'/g;var qe=/"/g;var Qe=/^(?:script|style|textarea|title)$/i;var Je=s=>(e,...t)=>({_$litType$:s,strings:e,values:t});var vt=Je(1);var Nt=Je(2);var J=Symbol.for("lit-noChange");var d=Symbol.for("lit-nothing");var Le=new WeakMap;var T=D.createTreeWalker(D,129);function Xe(s,e){if(!Array.isArray(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==Ie?Ie.createHTML(e):e}var wt=(s,e)=>{const t=s.length-1,r=[];let n,i=2===e?"<svg>":"",o=W;for(let a=0;a<t;a++){const c=s[a];let l,h,u=-1,f=0;for(;f<c.length&&(o.lastIndex=f,h=o.exec(c),null!==h);)f=o.lastIndex,o===W?"!--"===h[1]?o=Fe:void 0!==h[1]?o=He:void 0!==h[2]?(Qe.test(h[2])&&(n=RegExp("</"+h[2],"g")),o=C):void 0!==h[3]&&(o=C):o===C?">"===h[0]?(o=n!=null?n:W,u=-1):void 0===h[1]?u=-2:(u=o.lastIndex-h[2].length,l=h[1],o=void 0===h[3]?C:'"'===h[3]?qe:Re):o===qe||o===Re?o=C:o===Fe||o===He?o=W:(o=C,n=void 0);const _=o===C&&s[a+1].startsWith("/>")?" ":"";i+=o===W?c+mt:u>=0?(r.push(l),c.slice(0,u)+We+c.slice(u)+P+_):c+P+(-2===u?a:_)}return[Xe(s,i+(s[t]||"<?>")+(2===e?"</svg>":"")),r]};var X=class s{constructor({strings:e,_$litType$:t},r){let n;this.parts=[];let i=0,o=0;const a=e.length-1,c=this.parts,[l,h]=wt(e,t);if(this.el=s.createElement(l,r),T.currentNode=this.el.content,2===t){const u=this.el.content.firstChild;u.replaceWith(...u.childNodes)}for(;null!==(n=T.nextNode())&&c.length<a;){if(1===n.nodeType){if(n.hasAttributes())for(const u of n.getAttributeNames())if(u.endsWith(We)){const f=h[o++],_=n.getAttribute(u).split(P),A=/([.?@])?(.*)/.exec(f);c.push({type:1,index:i,name:A[2],strings:_,ctor:"."===A[1]?me:"?"===A[1]?ye:"@"===A[1]?ve:H}),n.removeAttribute(u)}else u.startsWith(P)&&(c.push({type:6,index:i}),n.removeAttribute(u));if(Qe.test(n.tagName)){const u=n.textContent.split(P),f=u.length-1;if(f>0){n.textContent=re?re.emptyScript:"";for(let _=0;_<f;_++)n.append(u[_],k()),T.nextNode(),c.push({type:2,index:++i});n.append(u[f],k())}}}else if(8===n.nodeType)if(n.data===Be)c.push({type:2,index:i});else{let u=-1;for(;-1!==(u=n.data.indexOf(P,u+1));)c.push({type:7,index:i}),u+=P.length-1}i++}}static createElement(e,t){const r=D.createElement("template");return r.innerHTML=e,r}};function F(s,e,t=s,r){var o,a,c;if(e===J)return e;let n=void 0!==r?(o=t._$Co)==null?void 0:o[r]:t._$Cl;const i=Q(e)?void 0:e._$litDirective$;return(n==null?void 0:n.constructor)!==i&&((a=n==null?void 0:n._$AO)==null?void 0:a.call(n,false),void 0===i?n=void 0:(n=new i(s),n._$AT(s,t,r)),void 0!==r?((c=t._$Co)!=null?c:t._$Co=[])[r]=n:t._$Cl=n),void 0!==n&&(e=F(s,n._$AS(s,e.values),n,r)),e}var be=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var l;const{el:{content:t},parts:r}=this._$AD,n=((l=e==null?void 0:e.creationScope)!=null?l:D).importNode(t,true);T.currentNode=n;let i=T.nextNode(),o=0,a=0,c=r[0];for(;void 0!==c;){if(o===c.index){let h;2===c.type?h=new G(i,i.nextSibling,this,e):1===c.type?h=new c.ctor(i,c.name,c.strings,this,e):6===c.type&&(h=new we(i,this,e)),this._$AV.push(h),c=r[++a]}o!==(c==null?void 0:c.index)&&(i=T.nextNode(),o++)}return T.currentNode=D,n}p(e){let t=0;for(const r of this._$AV)void 0!==r&&(void 0!==r.strings?(r._$AI(e,r,t),t+=r.strings.length-2):r._$AI(e[t])),t++}};var G=class s{get _$AU(){var e,t;return(t=(e=this._$AM)==null?void 0:e._$AU)!=null?t:this._$Cv}constructor(e,t,r,n){var i;this.type=2,this._$AH=d,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=r,this.options=n,this._$Cv=(i=n==null?void 0:n.isConnected)!=null?i:true}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===(e==null?void 0:e.nodeType)&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=F(this,e,t),Q(e)?e===d||null==e||""===e?(this._$AH!==d&&this._$AR(),this._$AH=d):e!==this._$AH&&e!==J&&this._(e):void 0!==e._$litType$?this.g(e):void 0!==e.nodeType?this.$(e):yt(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==d&&Q(this._$AH)?this._$AA.nextSibling.data=e:this.$(D.createTextNode(e)),this._$AH=e}g(e){var i;const{values:t,_$litType$:r}=e,n="number"==typeof r?this._$AC(e):(void 0===r.el&&(r.el=X.createElement(Xe(r.h,r.h[0]),this.options)),r);if(((i=this._$AH)==null?void 0:i._$AD)===n)this._$AH.p(t);else{const o=new be(n,this),a=o.u(this.options);o.p(t),this.$(a),this._$AH=o}}_$AC(e){let t=Le.get(e.strings);return void 0===t&&Le.set(e.strings,t=new X(e)),t}T(e){ke(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let r,n=0;for(const i of e)n===t.length?t.push(r=new s(this.k(k()),this.k(k()),this,this.options)):r=t[n],r._$AI(i),n++;n<t.length&&(this._$AR(r&&r._$AB.nextSibling,n),t.length=n)}_$AR(e=this._$AA.nextSibling,t){var r;for((r=this._$AP)==null?void 0:r.call(this,false,true,t);e&&e!==this._$AB;){const n=e.nextSibling;e.remove(),e=n}}setConnected(e){var t;void 0===this._$AM&&(this._$Cv=e,(t=this._$AP)==null?void 0:t.call(this,e))}};var H=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,r,n,i){this.type=1,this._$AH=d,this._$AN=void 0,this.element=e,this.name=t,this._$AM=n,this.options=i,r.length>2||""!==r[0]||""!==r[1]?(this._$AH=Array(r.length-1).fill(new String),this.strings=r):this._$AH=d}_$AI(e,t=this,r,n){const i=this.strings;let o=false;if(void 0===i)e=F(this,e,t,0),o=!Q(e)||e!==this._$AH&&e!==J,o&&(this._$AH=e);else{const a=e;let c,l;for(e=i[0],c=0;c<i.length-1;c++)l=F(this,a[r+c],t,c),l===J&&(l=this._$AH[c]),o||(o=!Q(l)||l!==this._$AH[c]),l===d?e=d:e!==d&&(e+=(l!=null?l:"")+i[c+1]),this._$AH[c]=l}o&&!n&&this.j(e)}j(e){e===d?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e!=null?e:"")}};var me=class extends H{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===d?void 0:e}};var ye=class extends H{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==d)}};var ve=class extends H{constructor(e,t,r,n,i){super(e,t,r,n,i),this.type=5}_$AI(e,t=this){var o;if((e=(o=F(this,e,t,0))!=null?o:d)===J)return;const r=this._$AH,n=e===d&&r!==d||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,i=e!==d&&(r===d||n);n&&this.element.removeEventListener(this.name,this,r),i&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,r;"function"==typeof this._$AH?this._$AH.call((r=(t=this.options)==null?void 0:t.host)!=null?r:this.element,e):this._$AH.handleEvent(e)}};var we=class{constructor(e,t,r){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=r}get _$AU(){return this._$AM._$AU}_$AI(e){F(this,e)}};var _e=B.litHtmlPolyfillSupport;var Ve;_e==null?void 0:_e(X,G),((Ve=B.litHtmlVersions)!=null?Ve:B.litHtmlVersions=[]).push("3.0.0");var Ge=(s,e,t)=>{var i,o;const r=(i=t==null?void 0:t.renderBefore)!=null?i:e;let n=r._$litPart$;if(void 0===n){const a=(o=t==null?void 0:t.renderBefore)!=null?o:null;r._$litPart$=n=new G(e.insertBefore(k(),a),a,void 0,t!=null?t:{})}return n._$AI(s),n};var rt=Symbol.for("immer-nothing");var Ye=Symbol.for("immer-draftable");var y=Symbol.for("immer-state");var gt=true?[function(s){return`The plugin for '${s}' has not been loaded into Immer. To enable the plugin, import and call \`enable${s}()\` when initializing your application.`},function(s){return`produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '${s}'`},"This object has been frozen and should not be mutated",function(s){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+s},"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.","Immer forbids circular references","The first or second argument to `produce` must be a function","The third argument to `produce` must be a function or undefined","First argument to `createDraft` must be a plain object, an array, or an immerable object","First argument to `finishDraft` must be a draft returned by `createDraft`",function(s){return`'current' expects a draft, got: ${s}`},"Object.defineProperty() cannot be used on an Immer draft","Object.setPrototypeOf() cannot be used on an Immer draft","Immer only supports deleting array indices","Immer only supports setting array indices and the 'length' property",function(s){return`'original' expects a draft, got: ${s}`}]:[];function b(s,...e){if(true){const t=gt[s];const r=typeof t==="function"?t.apply(null,e):t;throw new Error(`[Immer] ${r}`)}throw new Error(`[Immer] minified error nr: ${s}. Full error at: https://bit.ly/3cXEKWf`)}var R=Object.getPrototypeOf;function q(s){return!!s&&!!s[y]}function M(s){var e;if(!s)return false;return st(s)||Array.isArray(s)||!!s[Ye]||!!((e=s.constructor)==null?void 0:e[Ye])||oe(s)||ae(s)}var At=Object.prototype.constructor.toString();function st(s){if(!s||typeof s!=="object")return false;const e=R(s);if(e===null){return true}const t=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;if(t===Object)return true;return typeof t=="function"&&Function.toString.call(t)===At}function Y(s,e){if(ie(s)===0){Object.entries(s).forEach(([t,r])=>{e(t,r,s)})}else{s.forEach((t,r)=>e(r,t,s))}}function ie(s){const e=s[y];return e?e.type_:Array.isArray(s)?1:oe(s)?2:ae(s)?3:0}function xe(s,e){return ie(s)===2?s.has(e):Object.prototype.hasOwnProperty.call(s,e)}function nt(s,e,t){const r=ie(s);if(r===2)s.set(e,t);else if(r===3){s.add(t)}else s[e]=t}function xt(s,e){if(s===e){return s!==0||1/s===1/e}else{return s!==s&&e!==e}}function oe(s){return s instanceof Map}function ae(s){return s instanceof Set}function N(s){return s.copy_||s.base_}function Ee(s,e){if(oe(s)){return new Map(s)}if(ae(s)){return new Set(s)}if(Array.isArray(s))return Array.prototype.slice.call(s);if(!e&&st(s)){if(!R(s)){const n=Object.create(null);return Object.assign(n,s)}return V({},s)}const t=Object.getOwnPropertyDescriptors(s);delete t[y];let r=Reflect.ownKeys(t);for(let n=0;n<r.length;n++){const i=r[n];const o=t[i];if(o.writable===false){o.writable=true;o.configurable=true}if(o.get||o.set)t[i]={configurable:true,writable:true,enumerable:o.enumerable,value:s[i]}}return Object.create(R(s),t)}function je(s,e=false){if(ce(s)||q(s)||!M(s))return s;if(ie(s)>1){s.set=s.add=s.clear=s.delete=Et}Object.freeze(s);if(e)Y(s,(t,r)=>je(r,true),true);return s}function Et(){b(2)}function ce(s){return Object.isFrozen(s)}var $t={};function U(s){const e=$t[s];if(!e){b(0,s)}return e}var Z;function it(){return Z}function Ot(s,e){return{drafts_:[],parent_:s,immer_:e,canAutoFreeze_:true,unfinalizedDrafts_:0}}function Ze(s,e){if(e){U("Patches");s.patches_=[];s.inversePatches_=[];s.patchListener_=e}}function $e(s){Oe(s);s.drafts_.forEach(St);s.drafts_=null}function Oe(s){if(s===Z){Z=s.parent_}}function Ke(s){return Z=Ot(Z,s)}function St(s){const e=s[y];if(e.type_===0||e.type_===1)e.revoke_();else e.revoked_=true}function et(s,e){e.unfinalizedDrafts_=e.drafts_.length;const t=e.drafts_[0];const r=s!==void 0&&s!==t;if(r){if(t[y].modified_){$e(e);b(4)}if(M(s)){s=se(e,s);if(!e.parent_)ne(e,s)}if(e.patches_){U("Patches").generateReplacementPatches_(t[y].base_,s,e.patches_,e.inversePatches_)}}else{s=se(e,t,[])}$e(e);if(e.patches_){e.patchListener_(e.patches_,e.inversePatches_)}return s!==rt?s:void 0}function se(s,e,t){if(ce(e))return e;const r=e[y];if(!r){Y(e,(n,i)=>tt(s,r,e,n,i,t),true);return e}if(r.scope_!==s)return e;if(!r.modified_){ne(s,r.base_,true);return r.base_}if(!r.finalized_){r.finalized_=true;r.scope_.unfinalizedDrafts_--;const n=r.copy_;let i=n;let o=false;if(r.type_===3){i=new Set(n);n.clear();o=true}Y(i,(a,c)=>tt(s,r,n,a,c,t,o));ne(s,n,false);if(t&&s.patches_){U("Patches").generatePatches_(r,t,s.patches_,s.inversePatches_)}}return r.copy_}function tt(s,e,t,r,n,i,o){if(n===t)b(5);if(q(n)){const a=i&&e&&e.type_!==3&&!xe(e.assigned_,r)?i.concat(r):void 0;const c=se(s,n,a);nt(t,r,c);if(q(c)){s.canAutoFreeze_=false}else return}else if(o){t.add(n)}if(M(n)&&!ce(n)){if(!s.immer_.autoFreeze_&&s.unfinalizedDrafts_<1){return}se(s,n);if(!e||!e.scope_.parent_)ne(s,n)}}function ne(s,e,t=false){if(!s.parent_&&s.immer_.autoFreeze_&&s.canAutoFreeze_){je(e,t)}}function Pt(s,e){const t=Array.isArray(s);const r={type_:t?1:0,scope_:e?e.scope_:it(),modified_:false,finalized_:false,assigned_:{},parent_:e,base_:s,draft_:null,copy_:null,revoke_:null,isManual_:false};let n=r;let i=Ce;if(t){n=[r];i=K}const{revoke:o,proxy:a}=Proxy.revocable(n,i);r.draft_=a;r.revoke_=o;return a}var Ce={get(s,e){if(e===y)return s;const t=N(s);if(!xe(t,e)){return jt(s,t,e)}const r=t[e];if(s.finalized_||!M(r)){return r}if(r===ge(s.base_,e)){Ae(s);return s.copy_[e]=Pe(r,s)}return r},has(s,e){return e in N(s)},ownKeys(s){return Reflect.ownKeys(N(s))},set(s,e,t){const r=ot(N(s),e);if(r==null?void 0:r.set){r.set.call(s.draft_,t);return true}if(!s.modified_){const n=ge(N(s),e);const i=n==null?void 0:n[y];if(i&&i.base_===t){s.copy_[e]=t;s.assigned_[e]=false;return true}if(xt(t,n)&&(t!==void 0||xe(s.base_,e)))return true;Ae(s);Se(s)}if(s.copy_[e]===t&&(t!==void 0||e in s.copy_)||Number.isNaN(t)&&Number.isNaN(s.copy_[e]))return true;s.copy_[e]=t;s.assigned_[e]=true;return true},deleteProperty(s,e){if(ge(s.base_,e)!==void 0||e in s.base_){s.assigned_[e]=false;Ae(s);Se(s)}else{delete s.assigned_[e]}if(s.copy_){delete s.copy_[e]}return true},getOwnPropertyDescriptor(s,e){const t=N(s);const r=Reflect.getOwnPropertyDescriptor(t,e);if(!r)return r;return{writable:true,configurable:s.type_!==1||e!=="length",enumerable:r.enumerable,value:t[e]}},defineProperty(){b(11)},getPrototypeOf(s){return R(s.base_)},setPrototypeOf(){b(12)}};var K={};Y(Ce,(s,e)=>{K[s]=function(){arguments[0]=arguments[0][0];return e.apply(this,arguments)}});K.deleteProperty=function(s,e){if(isNaN(parseInt(e)))b(13);return K.set.call(this,s,e,void 0)};K.set=function(s,e,t){if(e!=="length"&&isNaN(parseInt(e)))b(14);return Ce.set.call(this,s[0],e,t,s[0])};function ge(s,e){const t=s[y];const r=t?N(t):s;return r[e]}function jt(s,e,t){var n;const r=ot(e,t);return r?`value`in r?r.value:(n=r.get)==null?void 0:n.call(s.draft_):void 0}function ot(s,e){if(!(e in s))return void 0;let t=R(s);while(t){const r=Object.getOwnPropertyDescriptor(t,e);if(r)return r;t=R(t)}return void 0}function Se(s){if(!s.modified_){s.modified_=true;if(s.parent_){Se(s.parent_)}}}function Ae(s){if(!s.copy_){s.copy_=Ee(s.base_,s.scope_.immer_.useStrictShallowCopy_)}}var Ct=class{constructor(s){this.autoFreeze_=true;this.useStrictShallowCopy_=false;this.produce=(e,t,r)=>{if(typeof e==="function"&&typeof t!=="function"){const i=t;t=e;const o=this;return function a(c=i,...l){return o.produce(c,h=>t.call(this,h,...l))}}if(typeof t!=="function")b(6);if(r!==void 0&&typeof r!=="function")b(7);let n;if(M(e)){const i=Ke(this);const o=Pe(e,void 0);let a=true;try{n=t(o);a=false}finally{if(a)$e(i);else Oe(i)}Ze(i,r);return et(n,i)}else if(!e||typeof e!=="object"){n=t(e);if(n===void 0)n=e;if(n===rt)n=void 0;if(this.autoFreeze_)je(n,true);if(r){const i=[];const o=[];U("Patches").generateReplacementPatches_(e,n,i,o);r(i,o)}return n}else b(1,e)};this.produceWithPatches=(e,t)=>{if(typeof e==="function"){return(o,...a)=>this.produceWithPatches(o,c=>e(c,...a))}let r,n;const i=this.produce(e,t,(o,a)=>{r=o;n=a});return[i,r,n]};if(typeof(s==null?void 0:s.autoFreeze)==="boolean")this.setAutoFreeze(s.autoFreeze);if(typeof(s==null?void 0:s.useStrictShallowCopy)==="boolean")this.setUseStrictShallowCopy(s.useStrictShallowCopy)}createDraft(s){if(!M(s))b(8);if(q(s))s=Tt(s);const e=Ke(this);const t=Pe(s,void 0);t[y].isManual_=true;Oe(e);return t}finishDraft(s,e){const t=s&&s[y];if(!t||!t.isManual_)b(9);const{scope_:r}=t;Ze(r,e);return et(void 0,r)}setAutoFreeze(s){this.autoFreeze_=s}setUseStrictShallowCopy(s){this.useStrictShallowCopy_=s}applyPatches(s,e){let t;for(t=e.length-1;t>=0;t--){const n=e[t];if(n.path.length===0&&n.op==="replace"){s=n.value;break}}if(t>-1){e=e.slice(t+1)}const r=U("Patches").applyPatches_;if(q(s)){return r(s,e)}return this.produce(s,n=>r(n,e))}};function Pe(s,e){const t=oe(s)?U("MapSet").proxyMap_(s,e):ae(s)?U("MapSet").proxySet_(s,e):Pt(s,e);const r=e?e.scope_:it();r.drafts_.push(t);return t}function Tt(s){if(!q(s))b(10,s);return at(s)}function at(s){if(!M(s)||ce(s))return s;const e=s[y];let t;if(e){if(!e.modified_)return e.base_;e.finalized_=true;t=Ee(s,e.scope_.immer_.useStrictShallowCopy_)}else{t=Ee(s,true)}Y(t,(r,n)=>{nt(t,r,at(n))});if(e){e.finalized_=false}return t}var v=new Ct;var z=v.produce;var Ut=v.produceWithPatches.bind(v);var zt=v.setAutoFreeze.bind(v);var It=v.setUseStrictShallowCopy.bind(v);var Ft=v.applyPatches.bind(v);var Ht=v.createDraft.bind(v);var Rt=v.finishDraft.bind(v);var Te=class{constructor(e){if(typeof e==="function"){this.observer={next:e}}else{this.observer=e}this.teardowns=[];if(typeof AbortController!=="undefined"){this.controller=new AbortController;this.signal=this.controller.signal}this.isUnsubscribed=false}next(e){if(!this.isUnsubscribed&&this.observer.next){this.observer.next(e)}}complete(){if(!this.isUnsubscribed){if(this.observer.complete){this.observer.complete()}this.unsubscribe()}}error(e){if(!this.isUnsubscribed){if(this.observer.error){this.observer.error(e)}this.unsubscribe()}}addTeardown(e){this.teardowns.push(e)}unsubscribe(){if(!this.isUnsubscribed){this.isUnsubscribed=true;if(this.controller){this.controller.abort()}this.teardowns.forEach(e=>{if(typeof e!=="function"){throw new Error("[Cami.js] Teardown must be a function. Please implement a teardown function in your subscriber.")}e()})}}};var m=class{constructor(e=()=>()=>{}){this._observers=[];this.subscribeCallback=e}subscribe(e=()=>{},t=()=>{},r=()=>{}){let n;if(typeof e==="function"){n={next:e,error:t,complete:r}}else if(typeof e==="object"){n=e}else{throw new Error("[Cami.js] First argument to subscribe must be a next callback or an observer object")}const i=new Te(n);let o=()=>{};try{o=this.subscribeCallback(i)}catch(a){if(i.error){i.error(a)}else{console.error("[Cami.js] Error in Subscriber:",a)}return}i.addTeardown(o);this._observers.push(i);return{unsubscribe:()=>i.unsubscribe(),complete:()=>i.complete(),error:a=>i.error(a)}}next(e){this._observers.forEach(t=>{t.next(e)})}error(e){this._observers.forEach(t=>{t.error(e)})}complete(){this._observers.forEach(e=>{e.complete()})}onValue(e){return this.subscribe({next:e})}onError(e){return this.subscribe({error:e})}onEnd(e){return this.subscribe({complete:e})}[Symbol.asyncIterator](){let e;let t;let r=new Promise(n=>t=n);e={next:n=>{t({value:n,done:false});r=new Promise(i=>t=i)},complete:()=>{t({done:true})},error:n=>{throw n}};this.subscribe(e);return{next:()=>r}}};var ee=class extends m{constructor(e){if(typeof e!=="object"||e===null){throw new TypeError("[Cami.js] initialState must be an object")}super(t=>{this._subscriber=t;return()=>{this._subscriber=null}});this.state=new Proxy(e,{get:(t,r)=>{return t[r]},set:(t,r,n)=>{t[r]=n;this._observers.forEach(i=>i.next(this.state));if(this.devTools){this.devTools.send(r,this.state)}return true}});this.reducers={};this.middlewares=[];this.devTools=this.connectToDevTools();Object.keys(e).forEach(t=>{if(typeof e[t]==="function"){this.register(t,e[t])}else{this.state[t]=e[t]}})}_applyMiddleware(e,...t){const r={state:this.state,action:e,payload:t};for(const n of this.middlewares){n(r)}}connectToDevTools(){if(typeof window!=="undefined"&&window["__REDUX_DEVTOOLS_EXTENSION__"]){const e=window["__REDUX_DEVTOOLS_EXTENSION__"].connect();e.init(this.state);return e}return null}use(e){this.middlewares.push(e)}register(e,t){if(this.reducers[e]){throw new Error(`[Cami.js] Action type ${e} is already registered.`)}this.reducers[e]=t;this[e]=(...r)=>{this.dispatch(e,...r)}}dispatch(e,t){if(typeof e==="function"){return e(this.dispatch.bind(this),()=>this.state)}if(typeof e!=="string"){throw new Error(`[Cami.js] Action type must be a string. Got: ${typeof e}`)}const r=this.reducers[e];if(!r){console.warn(`No reducer found for action ${e}`);return}this._applyMiddleware(e,t);this.state=z(this.state,n=>{r(n,t)});this._observers.forEach(n=>n.next(this.state));if(this.devTools){this.devTools.send(e,this.state)}}};var O=class s extends m{static from(e){if(e instanceof m){return new s(t=>{const r=e.subscribe({next:n=>t.next(n),error:n=>t.error(n),complete:()=>t.complete()});return()=>{if(!r.closed){r.unsubscribe()}}})}else if(e[Symbol.asyncIterator]){return new s(t=>{let r=false;(()=>I(this,null,function*(){try{try{for(var n=pe(e),i,o,a;i=!(o=yield n.next()).done;i=false){const c=o.value;if(r)return;t.next(c)}}catch(o){a=[o]}finally{try{i&&(o=n.return)&&(yield o.call(n))}finally{if(a)throw a[0]}}t.complete()}catch(c){t.error(c)}}))();return()=>{r=true}})}else if(e[Symbol.iterator]){return new s(t=>{try{for(const r of e){t.next(r)}t.complete()}catch(r){t.error(r)}return()=>{if(!subscription.closed){subscription.unsubscribe()}}})}else if(e instanceof Promise){return new s(t=>{e.then(r=>{t.next(r);t.complete()},r=>t.error(r));return()=>{}})}else{throw new TypeError("[Cami.js] ObservableStream.from requires an Observable, AsyncIterable, Iterable, or Promise")}}map(e){return new s(t=>{const r=this.subscribe({next:n=>t.next(e(n)),error:n=>t.error(n),complete:()=>t.complete()});return()=>r.unsubscribe()})}filter(e){return new s(t=>{const r=this.subscribe({next:n=>{if(e(n)){t.next(n)}},error:n=>t.error(n),complete:()=>t.complete()});return()=>r.unsubscribe()})}reduce(e,t){return new Promise((r,n)=>{let i=t;const o=this.subscribe({next:a=>{i=e(i,a)},error:a=>n(a),complete:()=>r(i)});return()=>o.unsubscribe()})}takeUntil(e){return new s(t=>{const r=this.subscribe({next:i=>t.next(i),error:i=>t.error(i),complete:()=>t.complete()});const n=e.subscribe({next:()=>{t.complete();r.unsubscribe();n.unsubscribe()},error:i=>t.error(i)});return()=>{r.unsubscribe();n.unsubscribe()}})}take(e){return new s(t=>{let r=0;const n=this.subscribe({next:i=>{if(r++<e){t.next(i)}else{t.complete();n.unsubscribe()}},error:i=>t.error(i),complete:()=>t.complete()});return()=>n.unsubscribe()})}drop(e){return new s(t=>{let r=0;const n=this.subscribe({next:i=>{if(r++>=e){t.next(i)}},error:i=>t.error(i),complete:()=>t.complete()});return()=>n.unsubscribe()})}flatMap(e){return new s(t=>{const r=new Set;const n=this.subscribe({next:i=>{const o=e(i);const a=o.subscribe({next:c=>t.next(c),error:c=>t.error(c),complete:()=>{r.delete(a);if(r.size===0){t.complete()}}});r.add(a)},error:i=>t.error(i),complete:()=>{if(r.size===0){t.complete()}}});return()=>{n.unsubscribe();r.forEach(i=>i.unsubscribe())}})}switchMap(e){return new s(t=>{let r=null;const n=this.subscribe({next:i=>{if(r){r.unsubscribe()}const o=e(i);r=o.subscribe({next:a=>t.next(a),error:a=>t.error(a),complete:()=>{if(r){r.unsubscribe();r=null}}})},error:i=>t.error(i),complete:()=>{if(r){r.unsubscribe()}t.complete()}});return()=>{n.unsubscribe();if(r){r.unsubscribe()}}})}toArray(){return new Promise((e,t)=>{const r=[];this.subscribe({next:n=>r.push(n),error:n=>t(n),complete:()=>e(r)})})}forEach(e){return new Promise((t,r)=>{this.subscribe({next:n=>e(n),error:n=>r(n),complete:()=>t()})})}every(e){return new Promise((t,r)=>{let n=true;this.subscribe({next:i=>{if(!e(i)){n=false;t(false)}},error:i=>r(i),complete:()=>t(n)})})}find(e){return new Promise((t,r)=>{const n=this.subscribe({next:i=>{if(e(i)){t(i);n.unsubscribe()}},error:i=>r(i),complete:()=>t(void 0)})})}some(e){return new Promise((t,r)=>{const n=this.subscribe({next:i=>{if(e(i)){t(true);n.unsubscribe()}},error:i=>r(i),complete:()=>t(false)})})}finally(e){return new s(t=>{const r=this.subscribe({next:n=>t.next(n),error:n=>{e();t.error(n)},complete:()=>{e();t.complete()}});return()=>{r.unsubscribe()}})}toState(e=null){const t=new x(e,null,{name:"ObservableStream"});this.subscribe({next:r=>t.update(()=>r),error:r=>t.error(r),complete:()=>t.complete()});return t}push(e){if(e instanceof m){const t=e.subscribe({next:r=>this._observers.forEach(n=>n.next(r)),error:r=>this._observers.forEach(n=>n.error(r)),complete:()=>this._observers.forEach(r=>r.complete())})}else if(e[Symbol.asyncIterator]){(()=>I(this,null,function*(){try{try{for(var t=pe(e),r,n,i;r=!(n=yield t.next()).done;r=false){const o=n.value;this._observers.forEach(a=>a.next(o))}}catch(n){i=[n]}finally{try{r&&(n=t.return)&&(yield n.call(t))}finally{if(i)throw i[0]}}this._observers.forEach(o=>o.complete())}catch(o){this._observers.forEach(a=>a.error(o))}}))()}else if(e[Symbol.iterator]){try{for(const t of e){this._observers.forEach(r=>r.next(t))}this._observers.forEach(t=>t.complete())}catch(t){this._observers.forEach(r=>r.error(t))}}else if(e instanceof Promise){e.then(t=>{this._observers.forEach(r=>r.next(t));this._observers.forEach(r=>r.complete())},t=>this._observers.forEach(r=>r.error(t)))}else{this._observers.forEach(t=>t.next(e))}}plug(e){e.subscribe({next:t=>this.push(t),error:t=>this._observers.forEach(r=>r.error(t)),complete:()=>this._observers.forEach(t=>t.complete())})}end(){this._observers.forEach(e=>{if(e&&typeof e.complete==="function"){e.complete()}})}catchError(e){return new s(t=>{const r=this.subscribe({next:n=>t.next(n),error:n=>{const i=e(n);i.subscribe({next:o=>t.next(o),error:o=>t.error(o),complete:()=>t.complete()})},complete:()=>t.complete()});return()=>r.unsubscribe()})}debounce(e){return new s(t=>{let r=null;const n=this.subscribe({next:i=>{clearTimeout(r);r=setTimeout(()=>{t.next(i)},e)},error:i=>t.error(i),complete:()=>{clearTimeout(r);t.complete()}});return()=>{clearTimeout(r);n.unsubscribe()}})}tap(e){return new s(t=>{const r=this.subscribe({next:n=>{e(n);t.next(n)},error:n=>t.error(n),complete:()=>t.complete()});return()=>r.unsubscribe()})}throttle(e){return new s(t=>{let r=0;const n=this.subscribe({next:i=>{const o=Date.now();if(o-r>e){r=o;t.next(i)}},error:i=>t.error(i),complete:()=>t.complete()});return()=>n.unsubscribe()})}distinctUntilChanged(){return new s(e=>{let t;let r=true;const n=this.subscribe({next:i=>{if(r||i!==t){r=false;t=i;e.next(i)}},error:i=>e.error(i),complete:()=>e.complete()});return()=>n.unsubscribe()})}concatMap(e){return new s(t=>{let r=null;let n=false;const i=[];const o=this.subscribe({next:a=>{if(!n){n=true;const c=e(a);r=c.subscribe({next:l=>t.next(l),error:l=>t.error(l),complete:()=>{if(i.length>0){const l=i.shift();const h=e(l);r=h.subscribe({next:u=>t.next(u),error:u=>t.error(u),complete:()=>n=false})}else{n=false}}})}else{i.push(a)}},error:a=>t.error(a),complete:()=>{if(!n){t.complete()}}});return()=>{o.unsubscribe();if(r){r.unsubscribe()}}})}combineLatest(...e){return new s(t=>{const r=new Array(e.length).fill(void 0);const n=e.map((i,o)=>i.subscribe({next:a=>{r[o]=a;if(!r.includes(void 0)){t.next([...r])}},error:a=>t.error(a),complete:()=>{}}));return()=>n.forEach(i=>i.unsubscribe())})}startWith(...e){return new s(t=>{e.forEach(n=>t.next(n));const r=this.subscribe({next:n=>t.next(n),error:n=>t.error(n),complete:()=>t.complete()});return()=>r.unsubscribe()})}};var L={events:{_state:true,get isEnabled(){return this._state},enable:function(){this._state=true},disable:function(){this._state=false}},debug:{_state:false,get isEnabled(){return this._state},enable:function(){console.log("Cami.js debug mode enabled");this._state=true},disable:function(){this._state=false}}};function p(s,...e){if(L.debug.isEnabled){if(s==="cami:state:change"){console.groupCollapsed(`%c[${s}]`,"color: #666666; padding: 1px 3px; border: 1px solid #bbbbbb; border-radius: 2px; font-size: 90%; display: inline-block;",`${e[0]} changed`);console.log(`oldValue:`,e[1]);console.log(`newValue:`,e[2])}else{console.groupCollapsed(`%c[${s}]`,"color: #666666; padding: 1px 3px; border: 1px solid #bbbbbb; border-radius: 2px; font-size: 90%; display: inline-block;",...e)}console.trace();console.groupEnd()}}var j={current:null};var x=class extends m{constructor(e=null,t=null,{last:r=false,name:n=null}={}){super();if(r){this._lastObserver=t}else{this._observers.push(t)}this._value=z(e,i=>{});this._pendingUpdates=[];this._updateScheduled=false;this._name=n}get value(){if(j.current!=null){j.current.addDependency(this)}return this._value}set value(e){this.update(()=>e)}assign(e){if(typeof this._value!=="object"||this._value===null){throw new Error("[Cami.js] Observable value is not an object")}this.update(t=>Object.assign(t,e))}set(e,t){if(typeof this._value!=="object"||this._value===null){throw new Error("[Cami.js] Observable value is not an object")}this.update(r=>{r[e]=t})}delete(e){if(typeof this._value!=="object"||this._value===null){throw new Error("[Cami.js] Observable value is not an object")}this.update(t=>{delete t[e]})}clear(){this.update(()=>({}))}push(...e){if(!Array.isArray(this._value)){throw new Error("[Cami.js] Observable value is not an array")}this.update(t=>{t.push(...e)})}pop(){if(!Array.isArray(this._value)){throw new Error("[Cami.js] Observable value is not an array")}this.update(e=>{e.pop()})}shift(){if(!Array.isArray(this._value)){throw new Error("[Cami.js] Observable value is not an array")}this.update(e=>{e.shift()})}splice(e,t,...r){if(!Array.isArray(this._value)){throw new Error("[Cami.js] Observable value is not an array")}this.update(n=>{n.splice(e,t,...r)})}unshift(...e){if(!Array.isArray(this._value)){throw new Error("[Cami.js] Observable value is not an array")}this.update(t=>{t.unshift(...e)})}reverse(){if(!Array.isArray(this._value)){throw new Error("[Cami.js] Observable value is not an array")}this.update(e=>{e.reverse()})}sort(e){if(!Array.isArray(this._value)){throw new Error("[Cami.js] Observable value is not an array")}this.update(t=>{t.sort(e)})}fill(e,t=0,r=this._value.length){if(!Array.isArray(this._value)){throw new Error("[Cami.js] Observable value is not an array")}this.update(n=>{n.fill(e,t,r)})}copyWithin(e,t,r=this._value.length){if(!Array.isArray(this._value)){throw new Error("[Cami.js] Observable value is not an array")}this.update(n=>{n.copyWithin(e,t,r)})}update(e){this._pendingUpdates.push(e);this.scheduleUpdate()}scheduleUpdate(){if(!this._updateScheduled){this._updateScheduled=true;this._applyUpdates()}}notifyObservers(){const e=[...this._observers,this._lastObserver];e.forEach(t=>{if(t&&typeof t==="function"){t(this._value)}else if(t&&t.next){t.next(this._value)}})}_applyUpdates(){let e=this._value;while(this._pendingUpdates.length>0){const t=this._pendingUpdates.shift();this._value=z(this._value,t)}if(e!==this._value){this.notifyObservers();if(L.events.isEnabled&&typeof window!=="undefined"){const t=new CustomEvent("cami:state:change",{detail:{name:this._name,oldValue:e,newValue:this._value}});window.dispatchEvent(t)}p("cami:state:change",this._name,e,this._value)}this._updateScheduled=false}toStream(){const e=new O;this.subscribe({next:t=>e.emit(t),error:t=>e.error(t),complete:()=>e.end()});return e}complete(){this._observers.forEach(e=>{if(e&&typeof e.complete==="function"){e.complete()}})}};var De=class extends x{constructor(e){super(null);this.computeFn=e;this.dependencies=new Set;this.subscriptions=new Map;this.compute()}get value(){if(j.current){j.current.addDependency(this)}return this._value}compute(){const e={addDependency:r=>{if(!this.dependencies.has(r)){const n=r.onValue(()=>this.compute());this.dependencies.add(r);this.subscriptions.set(r,n)}}};j.current=e;const t=this.computeFn();j.current=null;if(t!==this._value){this._value=t;this.notifyObservers()}}dispose(){this.subscriptions.forEach(e=>{e.unsubscribe()})}};var ct=function(s){return new De(s)};var ut=function(s){let e=()=>{};let t=new Set;let r=new Map;const n={addDependency:a=>{if(!t.has(a)){const c=a.onValue(i);t.add(a);r.set(a,c)}}};const i=()=>{e();j.current=n;e=s()||(()=>{});j.current=null};if(typeof window!=="undefined"){requestAnimationFrame(i)}else{setTimeout(i,0)}const o=()=>{r.forEach(a=>{a.unsubscribe()});e()};return o};var te=class extends O{constructor(e){super();if(typeof e==="string"){this.element=document.querySelector(e);if(!this.element){throw new Error(`[Cami.js] Element not found for selector: ${e}`)}}else if(e instanceof Element||e instanceof Document){this.element=e}else{throw new Error(`[Cami.js] Invalid argument: ${e}`)}}on(e,t={}){return new O(r=>{const n=i=>{r.next(i)};this.element.addEventListener(e,n,t);return()=>{this.element.removeEventListener(e,n,t)}})}};var ue=class extends O{constructor(){super(...arguments);ze(this,"_handlers",{})}toJson(){return new Promise((t,r)=>{this.subscribe({next:n=>{try{if(typeof n==="object"){t(n)}else{t(JSON.parse(n))}}catch(i){r(i)}},error:n=>r(n)})})}on(t,r){if(!this._handlers[t]){this._handlers[t]=[]}this._handlers[t].push(r);return this}};var w=s=>{if(typeof s==="string"){return w.get(s)}return new ue(e=>{const t=new XMLHttpRequest;t.open(s.method||"GET",s.url);if(s.headers){Object.keys(s.headers).forEach(r=>{t.setRequestHeader(r,s.headers[r])})}t.onload=()=>{let r=t.responseText;const n=s.transformResponse||(i=>{try{return JSON.parse(i)}catch(o){return i}});r=n(r);e.next(r);e.complete()};t.onerror=()=>e.error(t.statusText);t.send(s.data?JSON.stringify(s.data):null);return()=>{t.abort()}})};w.get=(s,e={})=>{e.url=s;e.method="GET";return w(e)};w.post=(s,e={},t={})=>{t.url=s;t.data=e;t.method="POST";return w(t)};w.put=(s,e={},t={})=>{t.url=s;t.data=e;t.method="PUT";return w(t)};w.patch=(s,e={},t={})=>{t.url=s;t.data=e;t.method="PATCH";return w(t)};w.delete=(s,e={})=>{e.url=s;e.method="DELETE";return w(e)};w.sse=(s,e={})=>{const t=new ue(r=>{const n=new EventSource(s,e);n.onmessage=i=>{if(t._handlers[i.type]){t._handlers[i.type].forEach(o=>o(i))}r.next(i)};n.onerror=i=>r.error(i);return()=>{n.close()}});return t};var E=new Map;var lt=class extends HTMLElement{constructor(){super();this._unsubscribers=new Map;this._effects=[];this.computed=ct.bind(this);this.effect=ut.bind(this);this._queryFunctions=new Map;this._pendingObservableUpdates=new Set}_isObjectOrArray(e){return e!==null&&(typeof e==="object"||Array.isArray(e))}_handleObjectOrArray(e,t,r,n=false){if(!(r instanceof x)){throw new TypeError("Expected observable to be an instance of ObservableState")}const i=this._observableProxy(r);Object.defineProperty(e,t,{get:()=>i,set:o=>{r.update(()=>o);if(n){this.setAttribute(t,o)}}})}_handleNonObject(e,t,r,n=false){if(!(r instanceof x)){throw new TypeError("Expected observable to be an instance of ObservableState")}Object.defineProperty(e,t,{get:()=>r.value,set:i=>{r.update(()=>i);if(n){this.setAttribute(t,i)}}})}_observableProxy(e){if(!(e instanceof x)){throw new TypeError("Expected observable to be an instance of ObservableState")}return new Proxy(e,{get:(t,r)=>{if(typeof t[r]==="function"){return t[r].bind(t)}else if(r in t){return t[r]}else if(typeof t.value[r]==="function"){return(...n)=>t.value[r](...n)}else{return t.value[r]}},set:(t,r,n)=>{t[r]=n;t.update(()=>t.value);return true}})}setup(e){if(e.infer===true){e.infer=["observables","computed"]}if(e.infer){e.infer.forEach(t=>{if(t==="observables"){Object.keys(this).forEach(r=>{if(typeof this[r]!=="function"&&!r.startsWith("_")){if(this[r]instanceof m){return}else{const n=this.observable(this[r],r);if(this._isObjectOrArray(n.value)){this._handleObjectOrArray(this,r,n)}else{this._handleNonObject(this,r,n)}}}})}else if(t==="computed"){Object.getOwnPropertyNames(Object.getPrototypeOf(this)).filter(r=>{const n=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(this),r);return n&&typeof n.get==="function"}).forEach(r=>{const n=Object.getOwnPropertyDescriptor(this,r);if(n&&typeof n.get==="function"){Object.defineProperty(this,r,{get:()=>this.computed(n.get).value})}})}})}if(e.observables){e.observables.forEach(t=>{if(this[t]instanceof m){return}const r=this.observable(this[t],t);if(this._isObjectOrArray(r.value)){this._handleObjectOrArray(this,t,r)}else{this._handleNonObject(this,t,r)}})}if(e.computed){e.computed.forEach(t=>{if(typeof t==="string"){const r=Object.getOwnPropertyDescriptor(this,t);if(r&&typeof r.get==="function"){Object.defineProperty(this,t,{get:()=>this.computed(r.get).value})}}else if(typeof t==="object"&&typeof t.get==="function"){Object.defineProperty(this,t.name,{get:()=>this.computed(t.get).value})}})}if(e.effects){e.effects.forEach(t=>{this.effect(t)})}if(e.attributes){Object.entries(e.attributes).forEach(([t,r])=>{const n=typeof r==="function"?this.observableAttr(t,r):this.observableAttr(t);if(this._isObjectOrArray(n.value)){this._handleObjectOrArray(this,t,n,true)}else{this._handleNonObject(this,t,n,true)}})}}observable(e,t=null){if(!this._isAllowedType(e)){const n=Object.prototype.toString.call(e);throw new Error(`[Cami.js] The type ${n} of initialValue is not allowed in observables.`)}const r=new x(e,n=>{this.scheduleUpdate(r)},{last:true,name:t});r.scheduleUpdate=this.scheduleUpdate.bind(this,r);this.registerObservables(r);return r}query({queryKey:e,queryFn:t,staleTime:r=0,refetchOnWindowFocus:n=true,refetchOnMount:i=true,refetchOnReconnect:o=true,refetchInterval:a=null,gcTime:c=1e3*60*5,retry:l=3,retryDelay:h=u=>Math.pow(2,u)*1e3}){const u=Array.isArray(e)?e.map(g=>typeof g==="object"?JSON.stringify(g):g).join(":"):e;this._queryFunctions.set(u,t);p("query","Starting query with key:",u);const f=this.observable({data:null,status:"pending",fetchStatus:"idle",error:null,lastUpdated:E.has(u)?E.get(u).lastUpdated:null},u);const _=this._observableProxy(f);const A=(g=0)=>I(this,null,function*(){const Ne=Date.now();const le=E.get(u);if(le&&Ne-le.lastUpdated<r){p("fetchData (if)","Using cached data for key:",u);f.update(S=>{S.data=le.data;S.status="success";S.fetchStatus="idle"})}else{p("fetchData (else)","Fetching data for key:",u);try{f.update($=>{$.status="pending";$.fetchStatus="fetching"});const S=yield t();E.set(u,{data:S,lastUpdated:Ne});f.update($=>{$.data=S;$.status="success";$.fetchStatus="idle"})}catch(S){p("fetchData (catch)","Fetch error for key:",u,S);if(g<l){setTimeout(()=>A(g+1),h(g))}else{f.update($=>{$.error={message:S.message};$.status="error";$.fetchStatus="idle"})}}}});if(i){p("query","Setting up refetch on mount for key:",u);A()}if(n){p("query","Setting up refetch on window focus for key:",u);const g=()=>A();window.addEventListener("focus",g);this._unsubscribers.set(`focus:${u}`,()=>window.removeEventListener("focus",g))}if(o){p("query","Setting up refetch on reconnect for key:",u);window.addEventListener("online",A);this._unsubscribers.set(`online:${u}`,()=>window.removeEventListener("online",A))}if(a){p("query","Setting up refetch interval for key:",u);const g=setInterval(A,a);this._unsubscribers.set(`interval:${u}`,()=>clearInterval(g))}const ht=setTimeout(()=>{E.delete(u)},c);this._unsubscribers.set(`gc:${u}`,()=>clearTimeout(ht));return _}mutation({mutationFn:e,onMutate:t,onError:r,onSuccess:n,onSettled:i}){const o=this.observable({data:null,status:"idle",error:null,isSettled:false},"mutation");const a=this._observableProxy(o);const c=l=>I(this,null,function*(){p("mutation","Starting mutation for variables:",l);let h;const u=o.value;if(t){p("mutation","Performing optimistic update for variables:",l);h=t(l,u);o.update(f=>{f.data=h.optimisticData;f.status="pending";f.error=null})}try{const f=yield e(l);o.update(_=>{_.data=f;_.status="success"});if(n){n(f,l,h)}p("mutation","Mutation successful for variables:",l,f)}catch(f){p("mutation","Mutation error for variables:",l,f);o.update(_=>{_.error={message:f.message};_.status="error";if(!r&&h&&h.rollback){p("mutation","Rolling back mutation for variables:",l);h.rollback()}});if(r){r(f,l,h)}}finally{if(!o.value.isSettled){o.update(f=>{f.isSettled=true});if(i){p("mutation","Calling onSettled for variables:",l);i(o.value.data,o.value.error,l,h)}}}});a.mutate=c;return a}invalidateQueries(e){const t=Array.isArray(e)?e.join(":"):e;p("invalidateQueries","Invalidating query with key:",t);E.delete(t);this.refetchQuery(t)}refetchQuery(e){p("refetchQuery","Refetching query with key:",e);const t=this._queryFunctions.get(e);if(t){p("refetchQuery","Found query function for key:",e);const r=E.get(e)||{data:void 0,status:"idle",error:null};E.set(e,fe(V({},r),{status:"pending",error:null}));t().then(n=>{E.set(e,{data:n,status:"success",error:null,lastUpdated:Date.now()});cosole.log("refetchQuery","Refetch successful for key:",e,n)}).catch(n=>{if(r.data!==void 0){p("refetchQuery","Rolling back refetch for key:",e);E.set(e,r)}E.set(e,fe(V({},r),{status:"error",error:n}))}).finally(()=>{this.query({queryKey:e,queryFn:t});p("refetchQuery","Refetch complete for key:",e)})}}_isAllowedType(e){const t=["number","string","boolean","object","undefined"];const r=typeof e;if(r==="object"){return e===null||Array.isArray(e)||this._isPlainObject(e)}return t.includes(r)}_isPlainObject(e){if(Object.prototype.toString.call(e)!=="[object Object]"){return false}const t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}observableAttr(e,t=r=>r){let r=this.getAttribute(e);r=z(r,t);return this.observable(r,e)}setObservables(e){Object.keys(e).forEach(t=>{if(this[t]instanceof m){this[t].next(e[t])}})}registerObservables(e){if(!(e instanceof x)){throw new TypeError("Expected observableState to be an instance of ObservableState")}this._unsubscribers.set(e,()=>e.dispose())}computed(e){const t=super.computed(e);this.registerObservables(t);return t}effect(e){const t=super.effect(e);this._unsubscribers.set(e,t)}connect(e,t){if(!(e instanceof ee)){throw new TypeError("Expected store to be an instance of ObservableStore")}const r=this.observable(e.state[t],t);const n=e.subscribe(i=>{r.update(()=>i[t])});this._unsubscribers.set(t,n);if(this._isObjectOrArray(r.value)){return this._observableProxy(r)}else{return new Proxy(r,{get:()=>r.value,set:(i,o,a)=>{if(o==="value"){r.update(()=>a)}else{i[o]=a}return true}})}}connectedCallback(){this.react()}disconnectedCallback(){this._unsubscribers.forEach(e=>e());this._effects.forEach(({cleanup:e})=>e&&e())}_processUpdates(){this._pendingObservableUpdates.forEach(e=>e._applyUpdates());this._pendingObservableUpdates.clear();this._updateScheduled=false;this.react()}scheduleUpdate(e){this._pendingObservableUpdates.add(e);if(!this._updateScheduled){this._updateScheduled=true;requestAnimationFrame(()=>this._processUpdates())}}eventStream(e){const t=new te(e.target);return t.on(e.type)}stream(e,t){const r=new te(e);return r.on(t)}react(){const e=this.template();Ge(e,this);this._effects.forEach(({effectFn:t})=>t.call(this))}template(){throw new Error("[Cami.js] You have to implement the method template()!")}};function Ar(s,e){if(!customElements.get(s)){customElements.define(s,e)}}function xr(s){return new ee(s)}var{debug:Er,events:$r}=L;export{m as Observable,te as ObservableElement,x as ObservableState,ee as ObservableStore,O as ObservableStream,lt as ReactiveElement,Er as debug,Ar as define,$r as events,vt as html,w as http,xr as store};
/**
 * @license
 * Copyright (c) 2023 Kenn Costales
 * MIT License
 */
/*! Bundled license information:

lit-html/lit-html.js:
  (**
   * @license
   * Copyright 2017 Google LLC
   * SPDX-License-Identifier: BSD-3-Clause
   *)
*/
//# sourceMappingURL=cami.module.js.map
